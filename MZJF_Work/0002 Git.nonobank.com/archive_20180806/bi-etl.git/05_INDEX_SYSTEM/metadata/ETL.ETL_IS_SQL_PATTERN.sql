# ************************************************************
# Sequel Pro SQL dump
# Version 4541
#
# http://www.sequelpro.com/
# https://github.com/sequelpro/sequelpro
#
# Host: 172.16.2.148 (MySQL 5.7.17-0ubuntu0.16.04.1-log)
# Database: ETL
# Generation Time: 2017-10-25 01:46:09 +0000
# ************************************************************


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;


# Dump of table ETL_IS_SQL_PATTERN
# ------------------------------------------------------------

DROP TABLE IF EXISTS `ETL_IS_SQL_PATTERN`;

CREATE TABLE `ETL_IS_SQL_PATTERN` (
  `PATTERN_ID` int(11) NOT NULL AUTO_INCREMENT COMMENT 'PK',
  `PATTERN_TEXT` text NOT NULL COMMENT '模式文本',
  `PATTERN_DESC` varchar(256) DEFAULT NULL COMMENT '模式描述',
  `CREATE_TIME` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `UPDATE_TIME` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `CREATE_BY` varchar(64) DEFAULT 'SYS' COMMENT '创建人',
  `UPDATE_BY` varchar(64) DEFAULT 'SYS' COMMENT '更新人',
  `PATTERN_DB` varchar(32) DEFAULT NULL COMMENT '模式对应的DB',
  `PATTERN_NAME` varchar(128) NOT NULL COMMENT '模式名称',
  PRIMARY KEY (`PATTERN_ID`),
  UNIQUE KEY `KEY_PATTERN_NAME` (`PATTERN_DB`,`PATTERN_NAME`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='sql模式配置表';

LOCK TABLES `ETL_IS_SQL_PATTERN` WRITE;
/*!40000 ALTER TABLE `ETL_IS_SQL_PATTERN` DISABLE KEYS */;

INSERT INTO `ETL_IS_SQL_PATTERN` (`PATTERN_ID`, `PATTERN_TEXT`, `PATTERN_DESC`, `CREATE_TIME`, `UPDATE_TIME`, `CREATE_BY`, `UPDATE_BY`, `PATTERN_DB`, `PATTERN_NAME`)
VALUES
	(1,'SELECT\n  tt.coupon_date                 AS dt,\n  tt.coupon_name                 AS coupon_name,\n  cash_value+rate_value          AS cost_amt,\n  tt.inv_amt                     AS inv_amt,\n  tt.usr_cnt,\n  tt.coupon_cnt\nFROM (\n SELECT\n  DATE(vf.service_time)                           AS coupon_date,\n  TRIM(IF(uc.approach_desc IS NULL OR uc.approach_desc = \'\',\'未知券码\',uc.approach_desc))   AS coupon_name,\n  SUM(IF(uc.type=0,uc.value,0))                   AS cash_value,\n  ROUND(SUM(IF(uc.type=1,IF(fp.expect_unit=0,CASE WHEN vf.MODE IN(8,9,10,11) THEN amount_payed* (CASE WHEN vf.MODE=8 THEN 3 WHEN vf.MODE=9 THEN 6 WHEN vf.MODE=10 THEN 12 WHEN vf.MODE=11 THEN 24 ELSE NULL END)/12 ELSE amount_payed*IFNULL(fp.expect,12)/12 END,amount_payed*fp.expect/360)*uc.value/100,0)),2) AS rate_value,\n  SUM(vf.amount_payed) AS inv_amt,\n  COUNT(DISTINCT uc.user_id) AS usr_cnt,\n  COUNT(uc.id) AS coupon_cnt\nFROM db_nono.coupon_use cu\n  JOIN db_nono.user_coupon uc\n    ON uc.id = cu.uv_id\n      AND cu.ir_product_type = 1\n  JOIN db_nono.vip_form vf\n    ON vf.id = cu.bb_id\n    AND vf.service_status = 1\n  JOIN db_nono.user_info ui\n    ON ui.id = vf.user_id\n  LEFT JOIN db_nono.finance_plan fp\n    ON vf.fp_id = fp.id\nwhere \nvf.service_time>=\'${V_BEGIN_DATE}\'\nand vf.service_time<\'${V_END_DATE}\'\nGROUP BY 1,2\n) tt','TV_按券码名称统计使用情况','2016-10-24 16:12:41','2017-06-30 13:30:50','SYS','bofei','nono','TV_按券码名称统计使用情况'),
	(3,'SELECT\r\n  vf.service_time                    AS dt,\r\n  trim(fp.title)                     AS product_name,\r\n  vf.user_id                         AS user_id,\r\n  vf.amount_payed                    as inv_amt\r\nFROM db_nono.vip_form vf\r\nJOIN db_nono.finance_plan fp\r\nON vf.fp_id = fp.id\r\nAND vf.service_status = 1','TV_按产品统计投资(精选)','2016-10-25 16:11:57','2017-06-30 13:30:50','SYS','bofei','nono','TV_按产品统计投资(精选)'),
	(4,'    SELECT\n        DATE_SUB(CURDATE(), INTERVAL 1 DAY) AS dt,\n        COUNT(DISTINCT tt.user_id)          AS hold_inv_usr_cnt,\n        SUM(tt.amount)                      AS hold_inv_amt         \n    FROM\n      (\n       SELECT user_id,amount\n        FROM db_nono.vip_account                                      \n        WHERE is_cash=0\n          UNION ALL\n        SELECT user_id,balance\n        FROM db_nono.finance_log                                     \n        WHERE operation_relation IN (470,323)\n        AND create_time >= DATE_SUB(CURDATE(), INTERVAL 1 DAY)\n        AND create_time < CURDATE()\n           UNION ALL\n       SELECT user_id,price_principal\n        FROM db_nono.borrows_accept \n       WHERE is_vip=0  and is_pay=0   \n      ) tt\n    GROUP BY 1','TV_诺诺在投','2016-10-25 17:14:14','2017-06-30 13:30:50','SYS','bofei','nono','TV_诺诺在投'),
	(6,'SELECT \n   t1.CUR_DT          as dt,\n   t1.user_id         as user_id,\n   t1.amount_payed    as inv_amt\nFROM\n(SELECT DATE(service_time) AS CUR_DT,user_id,amount_payed\n   FROM db_nono.vip_form -- 定期\n   WHERE service_status=1\n\nUNION ALL -- 债转\nSELECT DATE(pay_time) AS cur_dt,user_id,price_in\n		FROM db_nono.debt_buy_log\n		WHERE p_type=3\n		AND STATUS=1\n		AND (va_id IS NULL OR va_id =0)\nUNION ALL -- 散投\nselect date(pay_time) as cur_dt,bd.user_id,bd.price_in \nfrom db_nono.borrows_bidding bd \nwhere bd.is_vip = 0 and bd.status in(1,2) and reason = \'诺诺盈\'\n\nUNION ALL -- 活期\nSELECT DATE(ff_service_time) AS cur_dt,user_id,ff_amount_payed\n		FROM db_nono.fund_form ff\n         JOIN db_nono.csyy_plan cp\n      ON ff.csyy_serial_number = cp.serial_number\n		WHERE ff_service_status=1\n) t1\nINNER JOIN db_nono.user_info t2 ON t1.user_id=t2.id\nWHERE t2.ID NOT IN(920272,1598,1600,1176674)\nAND t2.is_special<>1','TV_投资/入金','2016-10-27 13:49:20','2017-06-30 13:30:50','SYS','bofei','nono','TV_投资/入金'),
	(7,'SELECT\n  t3.dt  as dt,\n  t3.val as cash_amt,\n  t3.user_id as user_id\nFROM (\n -- 优选\n SELECT\n    DATE(t1.cash_time) AS dt,\n    t1.amount AS val,\n    t1.user_id\n FROM db_nono.vip_account t1\nwhere t1.is_cash = 1\nand t1.cash_time>=\'${V_BEGIN_DATE}\'\nand t1.cash_time<\'${V_END_DATE}\'\n   UNION ALL\n -- 债转\n SELECT DATE(SUCCESS_TIME) AS dt,\n        PRICE_PRINCIPAL AS val,\n        user_id\n FROM db_nono.borrows_accept\n WHERE IS_PAY=1 AND IS_VIP=0\n and SUCCESS_TIME>=\'${V_BEGIN_DATE}\'\n and SUCCESS_TIME<\'${V_END_DATE}\'\n   UNION ALL\n -- 活期\n SELECT DATE(CREATE_TIME) AS dt,\n        FRF_AMOUNT AS val,\n        user_id\n FROM db_nono.fund_redeem_form\n where TYPE = 1\n and CREATE_TIME>=\'${V_BEGIN_DATE}\'\n and CREATE_TIME<\'${V_END_DATE}\'\n) t3\nJOIN db_nono.user_info t4\nON t3.USER_ID = t4.ID\nWHERE t4.ID NOT IN(920272,1598,1600,1176674)\nAND t4.IS_SPECIAL<>1','TV_兑付记录','2016-10-27 15:14:08','2017-06-30 13:30:50','SYS','bofei','nono','TV_兑付记录'),
	(8,'SELECT  REGISTER_TIME as dt,\n        id as user_id\n FROM db_nono.user_info\n WHERE PC_ID <> 18\n AND USER_NAME NOT LIKE \"%NNBANKAT%\" \n AND USER_TYPE IN(0,1)','诺诺_注册记录','2016-10-27 16:43:42','2017-06-30 13:30:50','SYS','bofei','nono','诺诺_注册记录'),
	(9,'SELECT \n  inv.dt,\n  inv.user_id,\n  inv.product_type,\n  inv.terminal,\n  inv.inv_amt,\n  usr.age,\n  IFNULL(re.name,\'(未知)\') AS province\nFROM (\nSELECT t1.dt,\n       t1.user_id,\n       t1.product_type,\n       t1.terminal,\n       t1.inv_amt\nFROM\n(SELECT service_time AS dt,user_id,\n        amount_payed AS inv_amt,\n        fpc.label AS product_type,\n        CASE vp.terminal\n         WHEN 0\n         THEN \'PC\'\n         WHEN 1\n         THEN \'名校贷\'\n         WHEN 2\n         THEN \'诺诺镑客app\'\n         WHEN 3\n         THEN \'诺诺镑客微站\'\n         WHEN 4\n         THEN \'诺诺镑客IOS\'\n         WHEN 5\n         THEN \'诺诺镑客Andriod\'\n         WHEN 6\n         THEN \'Ipad\'\n         WHEN 7\n         THEN \'微信\'\n         ELSE \'未知\'\n        END AS terminal\n   FROM db_nono.vip_form vp\n   LEFT JOIN db_nono.finance_plan fp\n   ON vp.fp_id = fp.id\n   LEFT JOIN db_nono.finance_plan_scope fpc\n   ON fp.scope = fpc.id\n   WHERE vp.service_status=1\n   and vp.service_time>= \'${V_BEGIN_DATE}\' and vp.service_time < \'${V_END_DATE}\'\nUNION ALL\nSELECT pay_time AS dt,user_id,price_in AS inv_amt,\'债转\' AS product_type,\n        CASE terminal\n         WHEN 0\n         THEN \'PC\'\n         WHEN 1\n         THEN \'名校贷\'\n         WHEN 2\n         THEN \'诺诺镑客app\'\n         WHEN 3\n         THEN \'诺诺镑客微站\'\n         WHEN 4\n         THEN \'诺诺镑客IOS\'\n         WHEN 5\n         THEN \'诺诺镑客Andriod\'\n         WHEN 6\n         THEN \'Ipad\'\n         WHEN 7\n         THEN \'微信\'\n         ELSE \'未知\'\n        END AS terminal\n  FROM db_nono.debt_buy_log\n   WHERE p_type=3 AND STATUS=1\n  AND (va_id IS NULL OR va_id =0)\n  and pay_time>= \'${V_BEGIN_DATE}\' and pay_time < \'${V_END_DATE}\'\nUNION ALL\nSELECT ff_service_time AS dt,user_id,ff_amount_payed AS inv_amt,\'诺诺钱包\' AS product_type,\n    CASE qudao\n         WHEN 0\n         THEN \'PC\'\n         WHEN 1\n         THEN \'名校贷\'\n         WHEN 2\n         THEN \'诺诺镑客app\'\n         WHEN 3\n         THEN \'诺诺镑客微站\'\n         WHEN 4\n         THEN \'诺诺镑客IOS\'\n         WHEN 5\n         THEN \'诺诺镑客Andriod\'\n         WHEN 6\n         THEN \'Ipad\'\n         WHEN 7\n         THEN \'微信\'\n         ELSE \'未知\'\n        END AS terminal\n  FROM db_nono.fund_form\n  WHERE ff_service_status=1\n  and ff_service_time>= \'${V_BEGIN_DATE}\' and ff_service_time < \'${V_END_DATE}\'\nUNION ALL\nSELECT   \n    bb.pay_time AS dt,bb.user_id,bb.price_in AS inv_amt,\'诺诺盈\' AS product_type,\n    CASE bb.terminal\n         WHEN 0\n         THEN \'PC\'\n         WHEN 1\n         THEN \'名校贷\'\n         WHEN 2\n         THEN \'诺诺镑客app\'\n         WHEN 3\n         THEN \'诺诺镑客微站\'\n         WHEN 4\n         THEN \'诺诺镑客IOS\'\n         WHEN 5\n         THEN \'诺诺镑客Andriod\'\n         WHEN 6\n         THEN \'Ipad\'\n         WHEN 7\n         THEN \'微信\'\n         ELSE \'未知\'\n        END AS terminal\nFROM db_nono.borrows_bidding bb\nLEFT JOIN db_nono.borrows bo ON bo.id = bb.bo_id\nLEFT JOIN db_nono.borrows_prepare bp ON bp.id = bo.bp_id\nWHERE bp.bp_is_index IN (2,3) AND bb.is_vip = 0 AND bb.status IN (1,2)\nand bb.pay_time>= \'${V_BEGIN_DATE}\' and bb.pay_time < \'${V_END_DATE}\'\n) t1\nINNER JOIN db_nono.user_info t2 ON t1.user_id=t2.id\nWHERE t2.ID NOT IN(920272,1598,1600,1176674)\nAND t2.is_special<>1\n) inv\nLEFT JOIN db_nono.user_info_detail usr\nON inv.user_id = usr.user_id\nLEFT JOIN db_nono.region re\nON usr.current_province = re.code','诺诺_投资记录','2016-10-28 15:10:38','2017-06-30 13:30:50','SYS','bofei','nono','诺诺_投资记录'),
	(10,'SELECT\r\n DATE(t1.card_auth_time) AS dt,\r\n t1.idnum AS id_num\r\nFROM db_nono.nono_authentication t1\r\nJOIN db_nono.user_info t2\r\nON t1.idnum = t2.id_num\r\nWHERE t1.is_card = 1\r\n AND  t2.PC_ID <> 18\r\n AND t2.USER_NAME NOT LIKE \"%NNBANKAT%\"\r\n AND t2.USER_TYPE IN (0,1)','诺诺_认证记录','2016-10-30 16:51:50','2017-06-30 13:30:50','SYS','bofei','nono','诺诺_认证记录'),
	(11,'SELECT\r\n  DATE(t1.create_time) AS dt,\r\n  t1.user_id\r\nFROM db_nono.user_bankcard_auth t1\r\nJOIN db_nono.user_info t2\r\nON t1.user_id = t2.id\r\nWHERE t1.auth_status IN (1,5)\r\nand t2.PC_ID <> 18\r\nAND t2.USER_NAME NOT LIKE \"%NNBANKAT%\"\r\n AND t2.USER_TYPE IN (0,1)','诺诺_绑卡记录','2016-10-30 17:17:58','2017-06-30 13:30:50','SYS','bofei','nono','诺诺_绑卡记录'),
	(12,' SELECT DATE(t1.CREATE_TIME) AS dt,\r\n        t1.user_id,\r\n        t1.AMOUNT AS rech_amt\r\n  FROM risk.DW_Nono_Recharge_Finance t1\r\n  LEFT JOIN db_nono.user_info t2\r\n  ON t1.user_id = t2.id\r\n  WHERE t2.PC_ID <> 18\r\n  AND t2.USER_NAME NOT LIKE \"%NNBANKAT%\"\r\n  AND t2.USER_TYPE IN (0,1)','诺诺_充值记录','2016-10-30 17:23:13','2017-06-30 13:30:50','SYS','bofei','nono','诺诺_充值记录'),
	(13,'SELECT \n   t1.create_time AS dt,\n   t1.user_id,\n   t1.price AS with_amt,\n   CASE t1.terminal\n      WHEN 0\n      THEN \'PC\'\n      WHEN 1\n      THEN \'名校贷\'\n      WHEN 2\n      THEN \'诺诺镑客app\'\n      WHEN 3\n      THEN \'诺诺镑客微站\'\n      WHEN 4\n      THEN \'诺诺镑客IOS\'\n      WHEN   5\n      THEN \'诺诺镑客Andriod\'\n      WHEN 6\n      THEN \'Ipad\'\n      WHEN   7\n      THEN \'微信\'\n      ELSE \'未知\'\n   END terminal\nFROM db_nono.withdraw_cash t1\nJOIN db_nono.user_info t2\nON t1.user_id = t2.id\nWHERE -- t1.status IN (0,1,2,4)\n-- and   \nt2.PC_ID <> 18\nAND t2.USER_NAME NOT LIKE \"%NNBANKAT%\"\nAND t2.USER_TYPE IN (0,1)\nand ifnull(bo_id,0)=0\nand t1.user_id NOT IN(166,168,169,170,920272,1598,1600,13936,1060684,897999,7589082,1006586,843923,2015856\n,2042527,8129243,1126825,10699642,1006463\n,71799,3393956,1245897,12444282,1025132\n,1025364,7060345,11995972,3404962,3408327\n,1348069,7847437,7448431,1011262,1404313\n,3392450,1006419,1024347,76551,3514689)\n','诺诺_取现记录','2016-10-30 17:28:43','2017-06-30 13:30:50','SYS','bofei','nono','诺诺_取现记录'),
	(14,'SELECT \n  create_time AS dt,\n  user_id,\n  terminal\nFROM db_nono.user_action_log\nWHERE action_type IN (1) \nand (action_from not in (\'csyy\') or action_from is null)\nand create_time>=\'${V_BEGIN_DATE}\'','诺诺_登录记录','2016-10-30 17:38:18','2017-06-30 13:30:50','SYS','bofei','nono','诺诺_登录记录'),
	(15,'SELECT\n  created_date AS dt,\n  user_code,\n  CASE user_type\n     WHEN 1\n     THEN \'IOS\'\n     WHEN 2\n     THEN \'ANDROID\'\n     ELSE \'未知\'\n  END terminal\nFROM nonobank_app.user','财神_注册记录','2016-11-01 15:20:24','2016-12-06 18:04:35','SYS','bofei','caishen','财神_注册记录'),
	(16,'SELECT\r\n  DATE(created_Date) AS dt,\r\n  user_code\r\nFROM nonobank_app.authen_log\r\nWHERE authen_result = \'1\'\r\nAND authen_type = \'01\'','财神_认证记录','2016-11-01 15:20:49','2016-12-08 16:05:29','SYS','bofei','caishen','财神_认证记录'),
	(17,'SELECT\r\n DATE(create_date) AS dt,\r\n user_code\r\nFROM nonobank_app.user_bind_card','财神_绑卡记录','2016-11-01 15:21:08','2016-12-08 16:05:29','SYS','bofei','caishen','财神_绑卡记录'),
	(18,'select\n  create_date AS dt,\n  user_code,\n  amount\nFROM nonobank_app.trans_detail\nWHERE trans_code = 1\nAND STATUS = 2\nand create_date>= \'${V_BEGIN_DATE}\'\nand create_date<\'${V_END_DATE}\'','财神_充值记录','2016-11-01 15:21:29','2017-03-13 21:15:34','SYS','bofei','caishen','财神_充值记录'),
	(19,'SELECT \n    inv.dt,\n    inv.user_code,\n    inv.product_code,\n    inv.product_type,\n    inv.inv_amt,\n    YEAR(NOW()) - YEAR(DATE_FORMAT(CASE WHEN LENGTH(usr.certificate_number)=18 THEN CONVERT(SUBSTR(usr.certificate_number,7,8),DATE) \n      WHEN LENGTH(usr.certificate_number)=15 THEN CONVERT(\'19\'+SUBSTR(usr.certificate_number,7,6),DATE) \n      ELSE NULL END,\'%Y-%m-%d\')) AS age,\n    pro.name AS province,\n    inv.product_name AS product_name\nFROM (\nSELECT\n    DATE_FORMAT(CONCAT(td.trans_date,td.trans_time),\"%Y-%m-%d %H:%i:%s\")  AS dt,\n    td.user_code,\n    td.product_code,\n    pii.product_name,\n    \'活期\' AS product_type,\n    td.amount AS inv_amt\nFROM nonobank_app.trans_detail td\nINNER JOIN nonobank_app.product_info pii\nON pii.product_code=td.product_code\nWHERE td.status = 2\nAND td.trans_code IN (1,8)\nAND pii.product_name   IN(\"财神招牌宝\",\"财神优选宝\",\"新优选宝\")\nAND td.user_code !=999999999\nAND td.trans_date>=DATE_FORMAT(\"${V_BEGIN_DATE}\",\"%Y%m%d\")\n			AND td.trans_date<DATE_FORMAT(\"${V_END_DATE}\",\"%Y%m%d\")\n    UNION ALL\nSELECT   (op.created_date) AS dt,\n         op.user_code,\n         op.product_code,\n         pii.product_name,\n          \'定期\' AS product_type,\n         op.invest_amount AS inv_amt\nFROM nonobank_app.user_product op\nINNER JOIN nonobank_app.product_info pii\nON pii.product_code = op.product_code\nWHERE pii.product_name NOT IN (\"财神招牌宝\",\"财神优选宝\",\"新优选宝\")\nAND op.trans_code = 1\nAND op.status = 1\nAND op.user_code != 999999999\nand op.created_date>= \'${V_BEGIN_DATE}\' and op.created_date < \'${V_END_DATE}\' \n) inv\nLEFT JOIN nonobank_app.user_detail usr\nON inv.user_code = usr.user_code\nLEFT JOIN risk.province_lookup pro\nON SUBSTR(usr. certificate_number,1,2) = pro.code\n ','财神_投资记录','2016-11-01 15:21:55','2017-01-03 13:51:26','SYS','bofei','caishen','财神_投资记录'),
	(20,'SELECT\n create_date AS dt,\n  user_code,\n  withdraw_amount AS with_amt\nFROM nonobank_app.withdraw_reward','财神_取现记录','2016-11-01 15:22:17','2017-03-08 20:19:54','SYS','bofei','caishen','财神_取现记录'),
	(21,'SELECT\n  bo.bo_audit_time AS dt,\n  bo.user_id,\n  CASE\n    WHEN p.p_name IN (\'大房东\') OR bo.id IN (61892,61894,74633,76582,76834)\n    THEN \'大房东\'\n    WHEN p.p_name IN (\'名校贷应急包\',\'名校贷\',\'白领包\',\'专科包\',\'美国名校贷\',\'UniFi小额贷\',\'麦芽分期\',\'名校贷（一键代还）\')\n    THEN p.p_name\n    ELSE \'其他\'\n  END                    AS product_name,\n  CASE\n    WHEN p.p_name IN (\'名校贷应急包\',\'名校贷\',\'白领包\',\'专科包\',\'名校贷（一键代还）\')\n    THEN \'名校贷\'\n    WHEN p.p_name IN (\'大房东\') OR bo.id IN (61892,61894,74633,76582,76834)\n    THEN \'大房东\'\n    WHEN p.p_name IN (\'美国名校贷\',\'UniFi小额贷\')\n    THEN \'UNIFI\'\n    WHEN p.p_name IN (\'麦芽分期\')\n    THEN \'麦芽分期\'\n    ELSE \'其他\'\n  END AS company,bo.p_id,\n  bo.bo_price     AS bo_amt\nFROM db_nono.borrows bo\nJOIN db_nono.products p\nON p.id=bo.p_id JOIN db_nono.borrows_archive ba ON ba.bo_id=bo.id\nWHERE ba.is_confirm = 1 and bo.bo_audit_time>= \'${V_BEGIN_DATE}\' and bo.bo_audit_time < \'${V_END_DATE}\'','资产端_借款','2016-11-04 18:26:31','2017-06-30 13:30:50','SYS','bofei','nono','资产端_借款'),
	(22,'\n  SELECT\n  DATE(br.br_repay_time) AS dt, br.br_repay_time,\n  bo.user_id,\n  CASE\n    WHEN p.p_name IN (\'大房东\') OR bo.id IN (61892,61894,74633,76582,76834)\n    THEN \'大房东\'\n    WHEN p.p_name IN (\'名校贷应急包\',\'名校贷\',\'白领包\',\'专科包\',\'美国名校贷\',\'UniFi小额贷\',\'麦芽分期\')\n    THEN p.p_name\n    ELSE \'其他\'\n  END                    AS product_name,\n  CASE\n    WHEN p.p_name IN (\'名校贷应急包\',\'名校贷\',\'白领包\',\'专科包\')\n    THEN \'名校贷\'\n    WHEN p.p_name IN (\'大房东\') OR bo.id IN (61892,61894,74633,76582,76834)\n    THEN \'大房东\'\n    WHEN p.p_name IN (\'美国名校贷\',\'UniFi小额贷\')\n    THEN \'UNIFI\'\n    WHEN p.p_name IN (\'麦芽分期\')\n    THEN \'麦芽分期\'\n    ELSE \'其他\'\n  END AS company,\n  br.br_price_b      AS rep_principal_amt,\n  br.br_price_l      AS rep_interest_amt,\n  br.br_price_punish AS rep_punish_amt,\n  br.price_return    AS rep_discount_amt\nFROM db_nono.borrows_repayment br\nJOIN db_nono.borrows bo\nON br.bo_id = bo.id\nJOIN db_nono.products p\nON p.id=bo.p_id\nWHERE bo.bo_is_success = 1\nAND br.br_is_repay = 1\nAND br.br_repay_time>=\'${V_BEGIN_DATE}\'\nAND br.br_repay_time<\'${V_END_DATE}\' ','资产端_还款','2016-11-04 18:27:16','2017-06-30 13:30:50','SYS','bofei','nono','资产端_还款'),
	(23,'SELECT \na.id as user_id,\na.register_time as dt\nFROM db_nono.user_info a\nLEFT JOIN db_nono.user_approach_info b ON a.id=b.user_id\nLEFT JOIN db_nono.admin c ON c.id=b.channel_id\nLEFT JOIN db_nono.channel ch ON ch.id=b.channel_id\nWHERE\n(a.user_type in (3, 5, 12) OR c.am_name LIKE \'%mxd%\')\nAND (b.channel_id IS NULL OR b.channel_id NOT IN(1867,1882,1915)) \nAND (ch.channel_type IS NULL  OR  ch.channel_type<>8)\nAND  IFNULL(b.landing_page,\"x\") NOT LIKE \'%美国名校贷%\'','名校贷_注册记录','2016-11-05 23:26:15','2017-06-30 13:30:50','SYS','bofei','nono','名校贷_注册记录'),
	(24,'SELECT DATE(na.card_auth_time) AS dt,\r\n       ui.id AS user_id\r\nFROM db_nono.nono_authentication na\r\nJOIN db_nono.user_info ui\r\nON ui.id_num=na.idnum\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON ui.id=uai.user_id\r\nWHERE na.is_card = 1\r\nAND ui.user_type = 5\r\nAND (uai.channel_id IS NULL OR uai.channel_id NOT IN(1867,1882,1915))','名校贷_身份认证','2016-11-05 23:26:42','2017-06-30 13:30:50','SYS','bofei','nono','名校贷_身份认证'),
	(25,'SELECT\n   na.stu_auth_time AS dt,\n   ui.id AS user_id\nFROM db_nono.nono_authentication na\nJOIN db_nono.user_info ui\nON ui.id_num = na.idnum\nLEFT JOIN db_nono.user_approach_info uai\nON ui.id=uai.user_id\nWHERE na.is_student = 1\nAND ui.user_type = 5 and na.stu_auth_time>= \'${V_BEGIN_DATE}\' and na.stu_auth_time < \'${V_END_DATE}\'\nAND (uai.channel_id IS NULL OR uai.channel_id NOT IN(1867,1882,1915))','名校贷_学籍认证','2016-11-05 23:27:12','2017-06-30 13:30:50','SYS','bofei','nono','名校贷_学籍认证'),
	(26,'SELECT\r\n   DATE(na.edu_auth_time) AS dt,\r\n   ui.id AS user_id\r\nFROM db_nono.nono_authentication na\r\nJOIN db_nono.user_info ui\r\nON ui.id_num = na.idnum\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON ui.id=uai.user_id\r\nWHERE na.is_education = 1\r\nAND ui.user_type = 5\r\nAND (uai.channel_id IS NULL OR uai.channel_id NOT IN(1867,1882,1915))','名校贷_学历认证','2016-11-05 23:27:29','2017-06-30 13:30:50','SYS','bofei','nono','名校贷_学历认证'),
	(27,'SELECT bp.bp_publish_time AS dt,\n       bp.user_id,\n       bp.bp_price AS apply_principal,\n       CONCAT(bp.bp_expect,CASE bp.bp_expect_cat WHEN 1 THEN \'天\' WHEN 2 THEN \'月\' WHEN 3 THEN \'年\'END) AS apply_period,\n       bp.bp_rate AS apply_interest,\n       CASE bp.bp_channel WHEN 0 THEN \'APP\' WHEN 1 THEN \'PC\' ELSE \'未知\' END AS apply_terminal,\n       bp.bp_aim AS apply_aim,bp.p_id\nFROM db_nono.borrows_prepare bp\nWHERE bp.p_id  IN(77,83,87,88,102) and bp.bp_publish_time>= \'${V_BEGIN_DATE}\' and bp.bp_publish_time < \'${V_END_DATE}\' and bp.bp_pre_approval_status !=5','名校贷_借款申请','2016-11-05 23:28:11','2017-06-30 13:30:50','SYS','bofei','nono','名校贷_借款申请'),
	(28,'SELECT\r\n    DATE(ba.create_time) AS dt,\r\n    bo.user_id,\r\n    ba.is_confirm\r\nFROM db_nono.borrows_archive ba\r\nJOIN db_nono.borrows bo\r\nON bo.id=ba.bo_id\r\nWHERE  bo.p_id  IN(77,83,87,88)\r\nAND ba.keyword = \'borrow_video_audit\'','名校贷_视频认证','2016-11-05 23:28:38','2017-06-30 13:30:50','SYS','bofei','nono','名校贷_视频认证'),
	(29,'SELECT\r\n  DATE(ui.register_time) AS dt,\r\n  ui.id AS user_id\r\nFROM db_nono.user_info ui\r\nJOIN db_nono.borrows_prepare bp\r\nON ui.id = bo.user_id\r\nJOIN db_nono.products p\r\nON bp.p_id = p.id\r\nWHERE p.p_name IN (\'大房东\')','大房东_注册记录','2016-11-05 23:29:37','2017-06-30 13:30:50','SYS','bofei','nono','大房东_注册记录'),
	(30,'SELECT\r\n  DATE(na.card_auth_time) AS dt,\r\n  ui.id AS user_id\r\nFROM db_nono.nono_authentication na\r\nJOIN db_nono.user_info ui\r\nON na.idnum = ui.id_num\r\nJOIN db_nono.borrows_prepare bp\r\nON ui.id = bo.user_id\r\nJOIN db_nono.products p\r\nON bp.p_id = p.id\r\nWHERE p.p_name IN (\'大房东\')\r\nAND na.is_card = 1','大房东_身份认证','2016-11-05 23:35:20','2017-06-30 13:30:50','SYS','bofei','nono','大房东_身份认证'),
	(31,'SELECT DATE(bp.bp_publish_time) AS dt,\r\n       bp.user_id,\r\n       bp.bp_price AS apply_principal,\r\n       CONCAT(bp.bp_expect,CASE bp.bp_expect_cat WHEN 1 THEN \'天\' WHEN 2 THEN \'月\' WHEN 3 THEN \'年\'END) AS apply_period,\r\n       bp.bp_rate AS apply_interest,\r\n       CASE bp.bp_channel WHEN 0 THEN \'APP\' WHEN 1 THEN \'PC\' ELSE \'未知\' END AS apply_terminal,\r\n       bp.bp_aim AS apply_aim\r\nFROM db_nono.borrows_prepare bp\r\nJOIN db_nono.products p\r\nON bp.p_id = p.id\r\nWHERE p.p_name IN (\'大房东\')','大房东_借款申请','2016-11-05 23:35:43','2017-06-30 13:30:50','SYS','bofei','nono','大房东_借款申请'),
	(33,'SELECT\r\n date(tt.register_time) as dt\r\n tt.user_id\r\nFROM (\r\n\r\nSELECT\r\n  ui.id,ui.mobile_num,ui.password,ui.register_time,sti.academy,ch.channel_type,uai.landing_page\r\nFROM db_nono.user_info ui\r\nLEFT JOIN db_nono.user_student_info sti\r\nON ui.id = sti.user_id\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON uai.user_id = ui.id\r\nLEFT JOIN db_nono.channel ch\r\nON uai.channel_id = ch.id\r\nWHERE ( LENGTH(ui.mobile_num) = 10 OR ch.channel_type= 8 OR IFNULL(uai.landing_page,\"x\") LIKE \'%美国%\' )\r\nUNION ALL\r\nSELECT\r\n  uic.user_id,uic.mobile_num,NULL AS PASSWORD,uic.create_time AS register_time, NULL AS academy,\r\n  NULL AS channel_type,NULL AS landing_page\r\nFROM db_nono.unifi_InterestrateCut uic\r\n\r\n) tt\r\nWHERE tt.mobile_num IN (SELECT mobile_num FROM db_nono.user_info WHERE PASSWORD IS NOT NULL)','UNIFI_注册记录','2016-11-05 23:45:09','2017-06-30 13:30:50','SYS','bofei','nono','UNIFI_注册记录'),
	(34,'SELECT\r\n  DATE(ui.register_time) AS dt,\r\n  ui.id AS user_id,\r\n  ui.is_card,\r\n  ui.is_student,\r\n  ui.is_education\r\nFROM db_nono.user_info ui\r\nLEFT JOIN db_nono.user_info_detail uid\r\nON uid.user_id=ui.id\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON uai.user_id=ui.id\r\nLEFT JOIN db_nono.user_student_info usi\r\nON usi.user_id=ui.id\r\nLEFT JOIN db_nono.user_action_log ual\r\nON ual.user_id=ui.id AND ual.action_type=7\r\nLEFT JOIN db_nono.channel ch\r\nON ch.id=uai.channel_id\r\nWHERE (LENGTH(ui.mobile_num)=10 OR ch.channel_type=8\r\n      OR landing_page LIKE \'%美国名校贷%\'\r\n      OR mobile_num IN (SELECT mobile_num FROM db_nono.unifi_InterestrateCut))','UNIFI_认证记录(身份/学籍/学历)','2016-11-05 23:45:28','2017-06-30 13:30:50','SYS','bofei','nono','UNIFI_认证记录(身份/学籍/学历)'),
	(35,'SELECT DATE(ba.create_time) AS dt,\r\n       bo.user_id           AS user_id,\r\n       ba.is_confirm\r\nFROM db_nono.borrows_archive ba\r\nJOIN db_nono.borrows bo ON bo.id=ba.bo_id\r\nWHERE bo.p_id  IN (94,97)\r\nAND ba.keyword=\"borrow_video_audit\"','UNIFI_视频认证','2016-11-05 23:46:20','2017-06-30 13:30:50','SYS','bofei','nono','UNIFI_视频认证'),
	(36,'SELECT DATE(bp.bp_publish_time) AS dt,\r\n       bp.user_id,\r\n       bp.bp_price AS apply_principal,\r\n       CONCAT(bp.bp_expect,CASE bp.bp_expect_cat WHEN 1 THEN \'天\' WHEN 2 THEN \'月\' WHEN 3 THEN \'年\'END) AS apply_period,\r\n       bp.bp_rate AS apply_interest,\r\n       CASE bp.bp_channel WHEN 0 THEN \'APP\' WHEN 1 THEN \'PC\' ELSE \'未知\' END AS apply_terminal,\r\n       bp.bp_aim AS apply_aim\r\nFROM db_nono.borrows_prepare bp\r\nJOIN db_nono.products p\r\nON bp.p_id = p.id\r\nWHERE p.p_name IN (\'美国名校贷\',\'UniFi小额贷\')','UNIFI_借款申请','2016-11-06 08:55:42','2017-06-30 13:30:50','SYS','bofei','nono','UNIFI_借款申请'),
	(37,'-- 注册\r\nSELECT DATE(ui.register_time) AS dt,\r\n       ui.id  AS user_id,\r\n       \'注册\' AS action_type\r\nFROM db_nono.user_info ui\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON ui.id=uai.user_id\r\nWHERE ui.user_type=5\r\nAND (uai.channel_id IS NULL OR uai.channel_id NOT IN(1867,1882,1915))\r\nUNION ALL\r\n-- 身份认证\r\nSELECT DATE(na.card_auth_time) AS dt,\r\n       ui.id AS user_id,\r\n       \'身份认证\' AS action_type\r\nFROM db_nono.nono_authentication na\r\nJOIN db_nono.user_info ui\r\nON ui.id_num=na.idnum\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON ui.id=uai.user_id\r\nWHERE na.is_card = 1\r\nAND ui.user_type = 5\r\nAND (uai.channel_id IS NULL OR uai.channel_id NOT IN(1867,1882,1915))\r\nUNION ALL\r\n-- 学籍认证\r\nSELECT\r\n   DATE(na.stu_auth_time) AS dt,\r\n   ui.id AS user_id,\r\n   \'学籍认证\' AS action_type\r\nFROM db_nono.nono_authentication na\r\nJOIN db_nono.user_info ui\r\nON ui.id_num = na.idnum\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON ui.id=uai.user_id\r\nWHERE na.is_student = 1\r\nAND ui.user_type = 5\r\nAND (uai.channel_id IS NULL OR uai.channel_id NOT IN(1867,1882,1915))\r\nUNION ALL\r\n-- 学历认证\r\nSELECT\r\n   DATE(na.edu_auth_time) AS dt,\r\n   ui.id AS user_id,\r\n   \'学历认证\' AS action_type\r\nFROM db_nono.nono_authentication na\r\nJOIN db_nono.user_info ui\r\nON ui.id_num = na.idnum\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON ui.id=uai.user_id\r\nWHERE na.is_education = 1\r\nAND ui.user_type = 5\r\nAND (uai.channel_id IS NULL OR uai.channel_id NOT IN(1867,1882,1915))\r\nUNION ALL\r\n-- 借款申请\r\nSELECT DATE(bp.bp_publish_time) AS dt,\r\n       bp.user_id,\r\n       \'借款申请\' AS action_type\r\nFROM db_nono.borrows_prepare bp\r\nWHERE bp.p_id  IN(77,83,87,88)\r\nUNION ALL\r\n-- 视频认证\r\nSELECT\r\n    DATE(ba.create_time) AS dt,\r\n    bo.user_id,\r\n    \'视频认证\' AS action_type\r\nFROM db_nono.borrows_archive ba\r\nJOIN db_nono.borrows bo\r\nON bo.id=ba.bo_id\r\nWHERE  bo.p_id  IN(77,83,87,88)\r\nAND ba.keyword = \'borrow_video_audit\'','名校贷_流程记录','2016-11-06 10:55:35','2017-06-30 13:30:50','SYS','bofei','nono','名校贷_流程记录'),
	(38,'select dt,user_id,action_type \nfrom (\n-- 注册\nSELECT\n  substr(ui.register_time,1,10) AS dt,\n  ui.user_id AS user_id,\n  \'注册\' AS action_type\nFROM idw.dim_user ui\nUNION ALL\n-- 身份认证\nSELECT\n  substr(na.card_auth_time,1,10) AS dt,\n  ui.id AS user_id,\n  \'身份认证\' AS action_type\nFROM odsopr.nono_authentication na\nJOIN odsopr.user_info ui\nON na.idnum = ui.id_num\nwhere na.is_card = 1\nUNION ALL\n-- 借款申请\nSELECT substr(bp.bp_publish_time,1,10) AS dt,\n       bp.user_id,\n       \'借款申请\' AS action_type\nFROM idw.fact_borrows_prepare bp\nWHERE bp.busi_line IN (\'大房东\')\nunion all\n-- 放款\nSELECT substr(bo.bo_finish_time,1,10) AS dt,\n       bo.user_id,\n       \'放款\' AS action_type\nFROM idw.fact_borrows bo\nWHERE bo.busi_line IN (\'大房东\')\nunion all\n-- 还款\nSELECT substr(r.br_repay_time,1,10) AS dt,\n       r.user_id,\n       \'还款\' AS action_type\nFROM idw.fact_borrows_repayment r\nWHERE r.busi_line IN (\'大房东\')\n) tt\nwhere tt.user_id in (\n select t1.user_id \n from idw.fact_borrows_prepare t1\n where t1.busi_line in (\'大房东\')\n)\n','大房东_流程记录','2016-11-06 11:27:01','2017-05-08 14:35:08','SYS','liuhailiang','impala','大房东_流程记录'),
	(39,'-- 注册\r\nSELECT\r\n DATE(ui.register_time) AS dt,\r\n ui.id  AS user_id,\r\n \'注册\' AS action_type\r\nFROM db_nono.user_info ui\r\nLEFT JOIN db_nono.user_student_info sti\r\nON ui.id = sti.user_id\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON uai.user_id = ui.id\r\nLEFT JOIN db_nono.channel ch\r\nON uai.channel_id = ch.id\r\nWHERE ( LENGTH(ui.mobile_num) = 10 OR ch.channel_type= 8 OR IFNULL(uai.landing_page,\"x\") LIKE \'%美国%\' )\r\nUNION ALL\r\n-- 身份认证\r\nSELECT\r\n  DATE(ui.register_time) AS dt,\r\n  ui.id         AS user_id,\r\n  \'身份认证\'    AS action_type\r\nFROM db_nono.user_info ui\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON uai.user_id=ui.id\r\nLEFT JOIN db_nono.channel ch\r\nON ch.id=uai.channel_id\r\nWHERE (LENGTH(ui.mobile_num)=10 OR ch.channel_type=8\r\n      OR uai.landing_page LIKE \'%美国名校贷%\'\r\n      OR ui.mobile_num IN (SELECT mobile_num FROM db_nono.unifi_InterestrateCut))\r\nAND ui.is_card = 1\r\nUNION ALL\r\n-- 学籍认证\r\nSELECT\r\n  DATE(ui.register_time) AS dt,\r\n  ui.id     AS user_id,\r\n  \'学籍认证\' AS action_type\r\nFROM db_nono.user_info ui\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON uai.user_id=ui.id\r\nLEFT JOIN db_nono.channel ch\r\nON ch.id=uai.channel_id\r\nWHERE (LENGTH(ui.mobile_num)=10 OR ch.channel_type=8\r\n      OR uai.landing_page LIKE \'%美国名校贷%\'\r\n      OR ui.mobile_num IN (SELECT mobile_num FROM db_nono.unifi_InterestrateCut))\r\nAND ui.is_student= 1\r\nUNION ALL\r\n-- 学历认证\r\nSELECT\r\n  DATE(ui.register_time) AS dt,\r\n  ui.id AS user_id,\r\n  \'学历认证\' AS action_type\r\nFROM db_nono.user_info ui\r\nLEFT JOIN db_nono.user_approach_info uai\r\nON uai.user_id=ui.id\r\nLEFT JOIN db_nono.channel ch\r\nON ch.id=uai.channel_id\r\nWHERE (LENGTH(ui.mobile_num)=10 OR ch.channel_type=8\r\n      OR uai.landing_page LIKE \'%美国名校贷%\'\r\n      OR ui.mobile_num IN (SELECT mobile_num FROM db_nono.unifi_InterestrateCut))\r\nAND  ui.is_education= 1\r\nUNION ALL\r\n-- 借款申请\r\nSELECT DATE(bp.bp_publish_time) AS dt,\r\n       bp.user_id,\r\n       \'借款申请\' AS action_type\r\nFROM db_nono.borrows_prepare bp\r\nJOIN db_nono.products p\r\nON bp.p_id = p.id\r\nWHERE p.p_name IN (\'美国名校贷\',\'UniFi小额贷\')\r\nUNION ALL\r\n-- 视频认证\r\nSELECT DATE(ba.create_time) AS dt,\r\n       bo.user_id           AS user_id,\r\n       \'视频认证\'           AS  action_type\r\nFROM db_nono.borrows_archive ba\r\nJOIN db_nono.borrows bo ON bo.id=ba.bo_id\r\nWHERE bo.p_id  IN (94,97)\r\nAND ba.keyword=\"borrow_video_audit\"','UNIFI_流程记录','2016-11-06 12:02:56','2017-06-30 13:30:50','SYS','bofei','nono','UNIFI_流程记录'),
	(40,'SELECT DATE(ou.create_time) AS dt,\r\n       ou.id                AS user_id,\r\n       \'注册\'               AS action_type,\r\n       1                    AS action_amt\r\nFROM finance_order.ORD_USER ou\r\nUNION ALL\r\nSELECT \r\n       DATE(oo.create_time) AS dt,\r\n       oo.create_user AS user_id,\r\n       \'借款申请\'     AS action_type,\r\n       oo.principal   AS action_amt\r\nFROM finance_order.ORD_ORDER oo\r\nUNION ALL\r\nSELECT DATE(order_begin_date) AS dt,\r\n       oo.create_user AS user_id,\r\n       \'放款\'         AS action_type,\r\n       oo.principal   AS action_amt \r\nFROM finance_order.ORD_ORDER oo \r\nWHERE oo.status IN(6,7,8,10,11) ','麦芽分期_流程记录','2016-11-06 20:47:05','2016-12-08 16:05:29','SYS','bofei','caishen','麦芽分期_流程记录'),
	(41,'SELECT \n substr(success_time,1,10) as dt,\n user_id,\n price_principal as repay_amt \nFROM odsopr.borrows_accept ba\nWHERE is_vip=1  \nAND ba.user_id NOT IN (1598,1600,920272,1176674) ',NULL,'2016-11-30 11:10:14','2016-11-30 11:10:14','admin','admin',NULL,'impala_诺诺_还款记录'),
	(42,'SELECT \n substr(success_time,1,10) as dt,\n user_id,\n price_principal as repay_amt \nFROM odsopr.borrows_accept ba\nWHERE is_vip=1  \nAND ba.user_id NOT IN (1598,1600,920272,1176674) ',NULL,'2016-11-30 11:11:37','2016-11-30 11:11:37','admin','admin',NULL,'诺诺_还款记录'),
	(43,'SELECT \n substr(success_time,1,10) as dt,\n user_id,\n price_principal as repay_amt \nFROM odsopr.borrows_accept ba\nWHERE is_vip=1  \nAND ba.user_id NOT IN (1598,1600,920272,1176674) ','用于诺诺大屏','2016-11-30 11:24:04','2016-12-16 15:49:00','admin','bofei','impala','诺诺_还款记录'),
	(44,'SELECT \n  inv.dt,\n  inv.user_id,\n  inv.product_type,\n  inv.terminal,\n  inv.inv_amt,\n  usr.age,\n  IFNULL(re.name,\'(未知)\') AS province\nFROM (\nSELECT t1.dt,\n       t1.user_id,\n       t1.product_type,\n       t1.terminal,\n       t1.inv_amt\nFROM\n(SELECT DATE(service_time) AS dt,user_id,\n        amount_payed AS inv_amt,\n        fpc.label AS product_type,\n        CASE vp.terminal\n         WHEN 0\n         THEN \'PC\'\n         WHEN 1\n         THEN \'名校贷\'\n         WHEN 2\n         THEN \'诺诺镑客app\'\n         WHEN 3\n         THEN \'诺诺镑客微站\'\n         WHEN 4\n         THEN \'诺诺镑客IOS\'\n         WHEN 5\n         THEN \'诺诺镑客Andriod\'\n         WHEN 6\n         THEN \'Ipad\'\n         WHEN 7\n         THEN \'微信\'\n         ELSE \'未知\'\n        END AS terminal\n   FROM db_nono.vip_form vp\n   LEFT JOIN db_nono.finance_plan fp\n   ON vp.fp_id = fp.id\n   LEFT JOIN db_nono.finance_plan_scope fpc\n   ON fp.scope = fpc.id\n   WHERE vp.service_status=1\nUNION ALL\nSELECT DATE(pay_time) AS dt,user_id,price_in AS inv_amt,\'散投\' AS product_type,\n        CASE terminal\n         WHEN 0\n         THEN \'PC\'\n         WHEN 1\n         THEN \'名校贷\'\n         WHEN 2\n         THEN \'诺诺镑客app\'\n         WHEN 3\n         THEN \'诺诺镑客微站\'\n         WHEN 4\n         THEN \'诺诺镑客IOS\'\n         WHEN 5\n         THEN \'诺诺镑客Andriod\'\n         WHEN 6\n         THEN \'Ipad\'\n         WHEN 7\n         THEN \'微信\'\n         ELSE \'未知\'\n        END AS terminal\n		FROM db_nono.debt_buy_log\n	  WHERE p_type=3 AND STATUS=1\n		AND (va_id IS NULL OR va_id =0)\nUNION ALL\nSELECT DATE(ff_service_time) AS dt,user_id,ff_amount_payed AS inv_amt,\'诺诺钱包\' AS product_type,\n    CASE qudao\n         WHEN 0\n         THEN \'PC\'\n         WHEN 1\n         THEN \'名校贷\'\n         WHEN 2\n         THEN \'诺诺镑客app\'\n         WHEN 3\n         THEN \'诺诺镑客微站\'\n         WHEN 4\n         THEN \'诺诺镑客IOS\'\n         WHEN 5\n         THEN \'诺诺镑客Andriod\'\n         WHEN 6\n         THEN \'Ipad\'\n         WHEN 7\n         THEN \'微信\'\n         ELSE \'未知\'\n        END AS terminal\n		FROM db_nono.fund_form\n		WHERE ff_service_status=1\n) t1\nINNER JOIN db_nono.user_info t2 ON t1.user_id=t2.id\nWHERE t2.ID NOT IN(920272,1598,1600,1176674)\nAND t2.is_special<>1\n) inv\nLEFT JOIN db_nono.user_info_detail usr\nON inv.user_id = usr.user_id\nLEFT JOIN db_nono.region re\nON usr.current_province = re.code\n\n\n\n',NULL,'2016-11-30 17:38:35','2017-06-30 13:30:50','admin','bofei','nono','lz_test'),
	(45,'SELECT \n    SUM(INVEST_AMT) AS INVEST_AMT,\n    SUM(d_invest_amt) AS d_invest_amt\nFROM\n    (SELECT \n        0 AS INVEST_AMT, amount_payed AS d_invest_amt\n    FROM\n        db_nono.vip_form vf\n    WHERE\n        service_status = 1\n            AND vf.fp_id IN (SELECT \n                id\n            FROM\n                db_nono.finance_plan\n            WHERE\n                scope = 15)\n            AND service_time >= CURDATE() \n	UNION ALL \n	SELECT \n        0 AS INVEST_AMT,\n            - SUM(CASE\n                WHEN (CASE WHEN fl2.create_time IS NULL THEN va.cash_time ELSE  fl.create_time END) >= CURDATE() THEN IFNULL(vf.amount_payed, va.amount)\n                ELSE 0\n            END) AS d_invest_amt\n    FROM\n        db_nono.vip_account va\n    LEFT JOIN db_nono.vip_form vf ON vf.user_id = va.user_id\n        AND vf.fp_id = va.fp_id\n        AND vf.service_status = 1\n	LEFT JOIN (select CREATE_TIME,key_value from db_nono.finance_log where operation_relation =598 AND CREATE_TIME >=DATE_ADD(CURDATE(),INTERVAL -1 DAY)) fl ON fl.key_value=va.id\n    LEFT JOIN (select CREATE_TIME,key_value from db_nono.finance_log where operation_relation =597 AND CREATE_TIME >=DATE_ADD(CURDATE(),INTERVAL -1 DAY)) fl2 ON fl2.key_value=va.id\n    INNER JOIN db_nono.finance_plan fp ON va.fp_id = fp.id AND scope = 15\n    WHERE\n        va.is_cash = 1 \n		AND va.cash_time>=date_add(CURDATE(),interval -1 day)\n	UNION ALL \n	SELECT \n        SUM(IFNULL(vf.amount_payed, va.amount)) INVEST_AMT,\n            0 AS d_invest_amt\n    FROM\n        db_nono.vip_account va\n    LEFT JOIN db_nono.vip_form vf ON vf.user_id = va.user_id\n        AND vf.fp_id = va.fp_id\n        AND vf.service_status = 1\n    -- INNER JOIN db_nono.user_info usr ON va.user_id = usr.id\n    --     AND usr.is_special = 0\n    INNER JOIN db_nono.finance_plan fp ON va.fp_id = fp.id AND scope = 15\n    WHERE\n        is_cash = 0\n            -- AND va.user_id NOT IN (1600 , 1598, 920272, 1176674)\n            ) num',NULL,'2016-12-01 10:37:07','2017-06-30 13:30:50','bofei','bofei','nono','资金流动性_月月升_余额_日净入金'),
	(54,'SELECT \n    SUM(invest_amt) as invest_amt\nFROM\n    (SELECT \n        SUM(amount_payed) INVEST_AMT\n    FROM\n        db_nono.vip_form vf\n    INNER JOIN db_nono.finance_plan fp ON vf.fp_id = fp.id\n    WHERE\n        service_status = 1 AND fp.scope != 15\n            AND vf.service_time >= CURDATE() \n			and vf.user_id not in (920272,12027)\n	UNION ALL \n    SELECT \n        - SUM(IFNULL(vf.amount_payed, va.amount)) INVEST_AMT\n    FROM\n        db_nono.vip_account va\n    LEFT JOIN db_nono.vip_form vf ON vf.user_id = va.user_id\n        AND vf.fp_id = va.fp_id\n        AND vf.service_status = 1\n    INNER JOIN db_nono.finance_plan fp ON va.fp_id = fp.id AND scope != 15\n    INNER JOIN db_nono.finance_log fl2 ON fl2.key_value = va.id\n        AND fl2.operation_relation = 597\n        AND fl2.create_time >= CURDATE()\n		and va.user_id not in (920272,12027)\n        ) num',NULL,'2016-12-01 10:55:40','2017-06-30 13:30:50','bofei','bofei','nono','资金流动性_诺诺定期_日净入金'),
	(57,'SELECT \n    sum(COALESCE(vf.amount_payed,va.amount)) AS balance_amt\n    -- sum(case when va.fp_id is null then va.amount else 0 end) ,\n    -- sum(case when va.fp_id is null then vf.amount_payed else 0 end )\nFROM\n    db_nono.vip_account va\nleft JOIN\n    db_nono.vip_form vf ON vf.user_id = va.user_id\nAND vf.fp_id = va.fp_id\nAND vf.service_status = 1\nWHERE\n    va.is_cash = 0\n    and (\n    va.fp_id is null\n    or\n	va.fp_id in (select id from db_nono.finance_plan where scope != 15)\n    )\n	and va.user_id not in (920272,12027)',NULL,'2016-12-01 11:06:46','2017-06-30 13:30:50','bofei','bofei','nono','资金流动性_诺诺定期_余额'),
	(58,'SELECT \n    SUM(INVEST_AMT) AS INVEST_AMT,\n    SUM(d_invest_amt) AS d_invest_amt\nFROM\n    (SELECT \n        0 AS INVEST_AMT,\n            SUM(CASE\n                WHEN bd.pay_time >= CURDATE() THEN bd.price_in\n                ELSE 0\n            END) AS d_invest_amt\n    FROM\n        db_nono.borrows_bidding bd\n    WHERE\n        bd.is_vip = 0 AND bd.status IN (1 , 2) \n		and user_id NOT IN (920272,12027)\n		UNION ALL SELECT \n        SUM(CASE\n                WHEN is_pay = 0 THEN ba.price_principal\n                ELSE 0\n            END) ACCEPT_AMT,\n            - SUM(CASE\n                WHEN\n                    ba.success_time >= CURDATE()\n                        AND is_pay = 1\n                THEN\n                    ba.price_principal\n                ELSE 0\n            END) AS d_accept_amt\n    FROM\n        db_nono.borrows_accept ba\n    WHERE\n        ba.is_vip = 0\n        and user_id NOT IN (920272,12027)\n	UNION ALL SELECT \n        0 AS INVEST_AMT,\n        SUM(price_in) AS d_invest_amt\n    FROM\n        db_nono.debt_buy_log dbl\n    WHERE\n        dbl.p_type = 3 AND dbl.status = 1\n		and pay_time >= CURDATE()\n            AND (dbl.va_id IS NULL OR dbl.va_id = 0)\n			and user_id NOT IN (920272,12027)\n            ) num',NULL,'2016-12-01 11:08:34','2017-06-30 13:30:50','bofei','bofei','nono','资金流动性_诺诺散投_余额_日净入金'),
	(59,'SELECT \n    SUM(INVEST_AMT) AS INVEST_AMT,\n    SUM(d_invest_amt) AS d_invest_amt\nFROM\n    (SELECT \n        0 AS INVEST_AMT,\n            SUM(CASE\n                WHEN bd.pay_time >= CURDATE() THEN bd.price_in\n                ELSE 0\n            END) AS d_invest_amt\n    FROM\n        db_nono.borrows_bidding bd\n    WHERE\n        bd.is_vip = 0 AND bd.status IN (1 , 2) UNION ALL SELECT \n        SUM(CASE\n                WHEN is_pay = 0 THEN ba.price_principal\n                ELSE 0\n            END) ACCEPT_AMT,\n            - SUM(CASE\n                WHEN\n                    ba.success_time >= CURDATE()\n                        AND is_pay = 1\n                THEN\n                    ba.price_principal\n                ELSE 0\n            END) AS d_accept_amt\n    FROM\n        db_nono.borrows_accept ba\n    WHERE\n        ba.is_vip = 0\n            -- AND ba.user_id NOT IN (1600 , 1598, 920272, 1176674) \n            UNION ALL SELECT \n        SUM(dbl.price_in) AS INVEST_AMT,\n            SUM(CASE\n                WHEN pay_time >= CURDATE() THEN price_in\n                ELSE 0\n            END) AS d_invest_amt\n    FROM\n        db_nono.debt_buy_log dbl\n    WHERE\n        dbl.p_type = 3 AND dbl.status = 1\n            AND (dbl.va_id IS NULL OR dbl.va_id = 0)) num',NULL,'2016-12-01 11:08:34','2017-06-30 13:30:50','bofei','bofei','nono','资金流动性_诺诺债转_余额_日净入金'),
	(60,'SELECT \n    SUM(INVEST_AMT) as invest_amt,\n    sum(d_invest_amt) as d_invest_amt,\n	sum(case when liq_type=1 then d_invest_amt end) as in_invest_amt,\n	sum(case when liq_type=2 then abs(d_invest_amt) end) as out_invest_amt\nFROM\n    (SELECT \n        0 INVEST_AMT,\n        SUM(up.invest_amount) AS d_invest_amt,\n		1 as liq_type\n    FROM\n        nonobank_app.user_product up\n    WHERE\n        up.product_code = \'NN0018\'\n            AND up.trans_code = 1\n            AND up.status = 1\n            -- AND up.user_code != 999999999 \n			AND up.created_date >= CURDATE()\n	UNION ALL \n	SELECT \n		0 INVEST_AMT,\n		- SUM(uatl.amount) AS d_invest_amt,\n		2 as liq_type\n    FROM\n        nonobank_app.user_account_trans_log uatl\n	INNER JOIN nonobank_app.product_info b\n        ON b.product_code = uatl.role_key_word\n    WHERE\n        uatl.role_key_word = \'NN0018\'\n    AND uatl.operation_type = 40\n	AND uatl.create_date >= CURDATE()\n	UNION ALL\n	SELECT \n		SUM(remaining_principal) AS INVEST_AMT,\n		0 AS d_invest_amt,\n		0 as liq_type\n	FROM nonobank_app.user_product \n        WHERE trans_code=1\n        AND status=1\n		and product_code=\'NN0018\'\n	) NUM',NULL,'2016-12-01 17:23:36','2016-12-29 11:29:04','bofei','bofei','caishen','资金流动性_开心财神_余额_净入金'),
	(61,'SELECT \n    SUM(CASE\n        WHEN up.created_date >= CURDATE() THEN up.invest_amount\n        ELSE 0\n    END) - SUM(CASE\n        WHEN\n            DATE(DATE_ADD(up.invest_end_date,\n                    INTERVAL 1 DAY)) = CURDATE()\n        THEN\n            up.invest_amount\n        ELSE 0\n    END) AS d_invest_amt,\n    SUM(CASE\n        WHEN\n            DATE(DATE_ADD(up.invest_end_date,\n                    INTERVAL 1 DAY)) > CURDATE()\n        THEN\n            up.invest_amount\n        ELSE 0\n    END) AS invest_amt,\n	SUM(CASE\n        WHEN up.created_date >= CURDATE() THEN up.invest_amount\n        ELSE 0\n    END) as in_invest_amt,\n	SUM(CASE\n        WHEN\n            DATE(DATE_ADD(up.invest_end_date,\n                    INTERVAL 1 DAY)) = CURDATE()\n        THEN\n            up.invest_amount\n        ELSE 0\n    END) as out_invest_amt\nFROM\n    nonobank_app.user_product up\nWHERE\n    up.product_code NOT IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n        AND up.trans_code = 1\n        AND up.status = 1\n        AND up.user_code != 999999999',NULL,'2016-12-01 17:23:36','2016-12-29 11:40:22','bofei','bofei','caishen','资金流动性_财神定期_余额_净入金'),
	(62,'SELECT \n    SUM(invest_amt) AS invest_amt,\n    SUM(d_invest_amt) AS d_invest_amt,\n	sum(case when liq_type=1 then d_invest_amt else 0 end ) as in_invest_amt,\n	sum(case when liq_type=2 then abs(d_invest_amt) else 0 end ) as out_invest_amt\nFROM\n    (SELECT \n        0 AS invest_amt, td.amount AS d_invest_amt,\n		1 as liq_type\n    FROM\n        nonobank_app.trans_detail td\n    JOIN nonobank_app.product_rate pr ON td.product_code = pr.product_code\n    WHERE\n        td.status = 2\n            AND td.trans_code IN (1 , 8)\n            AND td.product_code IN (\'NN0005\' , \'NN00011\', \'NN0017\')\n            AND td.user_code != 999999999\n            AND STR_TO_DATE(CONCAT(td.trans_date, \' \', td.trans_time), \'%Y%m%d %H%i%s\') >= CURDATE() UNION ALL SELECT \n        0 AS invest_amt, - withdraw_amount AS d_cash_amt,2 as liq_type\n    FROM\n        nonobank_app.withdraw_reward wr\n    WHERE\n        wr.status IN (2 , 3, 8)\n            AND wr.trans_code IN (2 , 13, 15)\n            AND wr.user_code != 999999999\n            AND create_date >= CURDATE() UNION ALL SELECT \n        0 AS invest_amt, - urr.amount AS d_cash_amt,2 as liq_type\n    FROM\n        nonobank_app.userproduct_ratecard_relation urr\n    INNER JOIN nonobank_app.user_product up ON up.user_product_id = urr.user_product_id\n    WHERE\n        up.product_code IN (\'NN0005\' , \'NN00011\', \'NN0017\')\n            AND create_date >= CURDATE() UNION ALL SELECT \n        SUM(remaining_principal) AS invest_amt, 0 AS d_invest_amt,0 as liq_type\n    FROM\n        nonobank_app.user_product\n    WHERE\n        trans_code = 1 AND status <> \'A\'\n            AND product_code IN (\'NN0005\' , \'NN00011\', \'NN0017\')\n            AND user_code != 999999999) num',NULL,'2016-12-01 17:23:36','2016-12-29 11:36:22','bofei','bofei','caishen','资金流动性_财神活期_余额_净入金'),
	(63,'select count(distinct user_id) as user_cnt\nfrom (\nselect user_id\nfrom odsopr.vip_form_hist \nunion all\nselect ar.nono_user_id from odsopr.user_product_hist up \ninner join \nodsopr.account_relation_hist ar\non up.user_code=ar.merchant_user_id) tx',NULL,'2016-12-01 19:52:04','2016-12-01 19:52:04','bofei','bofei','impala','投资人数_财神_诺诺'),
	(64,'SELECT \n        (CASE\n                WHEN a.p_id IN (77 , 83, 87, 88) THEN 1\n                WHEN a.p_id = 92 THEN 5\n                WHEN a.p_id IN (94 , 97) THEN 4\n                WHEN a.p_id = 96 THEN 3\n                WHEN\n                    a.p_id = 86\n                        OR a.id IN (61892 , 61894, 74633, 76582, 76834)\n                THEN\n                    2\n                ELSE 6\n            END) AS PRO_TYPE,\n            SUM(bo.br_price_b) AS br_price_b\n    FROM\n        db_nono.borrows a\n    INNER JOIN db_nono.products b ON a.p_id = b.id\n    INNER JOIN db_nono.borrows_repayment bo ON a.id = bo.bo_id\n    WHERE\n        a.bo_is_success = 1\n            AND bo.br_repay_time IS NULL',NULL,'2016-12-02 11:12:20','2017-06-30 13:30:50','admin','bofei','nono','资金流动性_资产端_当前余额'),
	(65,'SELECT  (op.invest_begin_date) AS dt_begin,\n		date_add(op.invest_end_date,interval 1 day) AS dt_end,\n        op.user_code,\n        pii.product_name,\n        op.invest_amount AS inv_amt,\n		case when date_add(op.invest_end_date,interval 1 day) >= \'${V_BEGIN_DATE}\' then \'在投\' else \'到期\' end as in_service\nFROM nonobank_app.user_product op\nJOIN nonobank_app.product_info pii\nON pii.product_code = op.product_code\nWHERE pii.product_name not in  (\"财神招牌宝\",\"财神优选宝\",\"新优选宝\")\nAND op.trans_code = 1\nAND op.status = 1\nAND op.user_code != 999999999',NULL,'2016-12-02 18:08:41','2016-12-30 10:46:10','zhangbingcan','bofei','caishen','财神_定期投资记录'),
	(66,'SELECT  (op.invest_begin_date) AS dt_begin,\n        op.user_code,\n        pii.product_name,\n        op.invest_amount AS inv_amt,\n        op.remaining_principal as inv_amt_left\nFROM nonobank_app.user_product op\nJOIN nonobank_app.product_info pii\nON pii.product_code = op.product_code\nWHERE pii.product_name in  (\"财神招牌宝\",\"财神优选宝\",\"新优选宝\")\nAND op.trans_code = 1\nAND op.status = 1\nAND op.user_code != 999999999',NULL,'2016-12-02 19:40:11','2016-12-08 16:05:29','zhangbingcan','bofei','caishen','财神_活期投资记录'),
	(67,'  SELECT t1.CREATE_TIME AS dt,\n        t1.user_id,\n        t1.AMOUNT AS rech_amt\n  FROM \n  (SELECT \n	fl.id\n	,fl.account_id\n	,fa.user_id\n	,fl.amount\n	,fl.create_time\n	FROM db_nono.finance_log fl\n	JOIN db_nono.finance_account fa ON fa.id=fl.opposite_account_id\n	WHERE 1=1\n	and fl.create_time>= \'${V_BEGIN_DATE}\'\n	AND fl.create_time<\'${V_END_DATE}\'\n	AND fl.role_id IN(2,3)\n	AND fl.operation_relation IN(49,50,466,468)) t1\n  INNER JOIN db_nono.user_info t2\n  ON t1.user_id = t2.id\n  WHERE  t2.USER_NAME NOT LIKE \"%NNBANKAT%\"\n  AND t2.USER_TYPE IN (0,1)\n  AND t2.id NOT IN(166,168,169,170,920272,1598,1600,13936,1060684,897999,7589082,1006586,843923,2015856\n,2042527,8129243,1126825,10699642,1006463\n,71799,3393956,1245897,12444282,1025132\n,1025364,7060345,11995972,3404962,3408327\n,1348069,7847437,7448431,1011262,1404313\n,3392450,1006419,1024347,76551,3514689)',NULL,'2016-12-05 18:22:30','2017-06-30 13:30:50','bofei','bofei','nono','诺诺_充值记录_源表'),
	(68,'SELECT  create_time as dt,user_code,logon_status,logon_type,os_type,ip\nFROM nonobank_app.user_logon_info\nwhere \nlogon_status=0\nand create_time>=\'${V_BEGIN_DATE}\' \nAND create_time<\'${V_END_DATE}\'',NULL,'2016-12-06 18:07:56','2017-01-06 19:42:49','bofei','bofei','caishen','财神_登录记录'),
	(89,'select user_id,bp_aim,bp_title,\nbp_price,bp_expect,create_time,update_time\nfrom \ndb_nono.borrows_prepare',NULL,'2016-12-07 21:01:11','2017-06-30 13:30:50','bofei','bofei','nono','资产端_借款申请'),
	(90,'SELECT \n    uatl.create_date, uatl.amount, 1 as kind\nFROM\n    nonobank_app.user_account_trans_log uatl\n        INNER JOIN\n    nonobank_app.product_info b ON b.product_code = uatl.role_key_word\nWHERE\n    uatl.role_key_word = \'NN0018\'\n        AND uatl.operation_type = 40 \nUNION ALL SELECT \n    DATE_ADD(up.invest_end_date,\n        INTERVAL 1 DAY),\n    invest_amount, 2 as kind\nFROM\n    nonobank_app.user_product up\nWHERE\n    up.product_code NOT IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n        AND up.trans_code = 1\n        AND up.status = 1\n        AND up.user_code != 999999999 \nUNION ALL SELECT \n    create_date, wr.withdraw_amount AS CASH_AMT, 3 as kind\nFROM\n    nonobank_app.withdraw_reward wr\nWHERE\n    wr.status IN (2 , 3, 8)\n        AND wr.trans_code IN (2 , 13, 15)\n        AND wr.user_code != 999999999 \nUNION ALL SELECT \n    create_date, urr.amount, 4 as kind\nFROM\n    nonobank_app.userproduct_ratecard_relation urr\n        INNER JOIN\n    nonobank_app.user_product up ON up.user_product_id = urr.user_product_id\nWHERE\n    up.product_code IN (\'NN0005\' , \'NN00011\', \'NN0017\')',NULL,'2016-12-08 15:34:21','2016-12-09 18:08:26','bofei','bofei','caishen','财神_债权到期和取现'),
	(92,'SELECT \n    inv.dt,\n    inv.user_code,\n    inv.product_code,\n    inv.product_type,\n    inv.inv_amt,\n    inv.product_name AS product_name,\n	type_cd\nFROM\n    (SELECT \n        DATE_FORMAT(CONCAT(td.trans_date,td.trans_time),\"%Y-%m-%d %H:%i:%s\")  AS dt,\n            td.user_code,\n            td.product_code,\n            pii.product_name,\n            \'活期\' AS product_type,\n            td.amount AS inv_amt,\n			1 as type_cd\n    FROM\n        nonobank_app.trans_detail td\n    LEFT JOIN nonobank_app.product_info pii ON pii.product_code = td.product_code\n    WHERE\n        td.status = 2\n            AND td.trans_code IN (1 , 8)\n            AND pii.product_name IN (\'财神招牌宝\' , \'财神优选宝\', \'新优选宝\')\n			AND td.trans_date>=DATE_FORMAT(\"${V_BEGIN_DATE}\",\"%Y%m%d\")\n			AND td.trans_date<DATE_FORMAT(\"${V_END_DATE}\",\"%Y%m%d\")\n            AND td.user_code != 999999999 \n	UNION ALL \n	SELECT \n        (op.created_date) AS dt,\n            op.user_code,\n            op.product_code,\n            pii.product_name,\n            \'定期\' AS product_type,\n            op.invest_amount AS inv_amt,\n			2 as type_cd\n    FROM\n        nonobank_app.user_product op\n    LEFT JOIN nonobank_app.product_info pii ON pii.product_code = op.product_code\n    WHERE\n        pii.product_name NOT IN (\'财神招牌宝\' , \'财神优选宝\', \'新优选宝\')\n            AND op.trans_code = 1\n            AND op.status = 1\n			and op.created_date >= \'${V_BEGIN_DATE}\'\n			and op.created_date < \'${V_END_DATE}\'\n            AND op.user_code != 999999999 \n	UNION ALL \n	SELECT \n        uatl.create_date,\n            uatl.user_code,\n            role_key_word,\n            NULL,\n            \'定期\',\n            -uatl.amount,\n			3 as type_cd\n    FROM\n        nonobank_app.user_account_trans_log uatl\n    INNER JOIN nonobank_app.product_info b ON b.product_code = uatl.role_key_word\n    WHERE\n        uatl.role_key_word = \'NN0018\'\n		and uatl.create_date >= \'${V_BEGIN_DATE}\'\n			and uatl.create_date < \'${V_END_DATE}\' \n            AND uatl.operation_type = 40 \n	UNION ALL \n	SELECT \n        DATE_ADD(up.invest_end_date, INTERVAL 1 DAY),\n            user_code,\n            product_code,\n            NULL,\n            \'定期\',\n            -invest_amount,\n			4 as type_cd\n    FROM\n        nonobank_app.user_product up\n    WHERE\n        up.product_code NOT IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n            AND up.trans_code = 1\n            AND up.status = 1\n            AND up.user_code != 999999999 \n			AND DATE_ADD(up.invest_end_date, INTERVAL 1 DAY)>=\'${V_BEGIN_DATE}\'\n			AND DATE_ADD(up.invest_end_date, INTERVAL 1 DAY)<\'${V_END_DATE}\' \n	UNION ALL \n	SELECT \n        create_date,\n            wr.user_code,\n            NULL,\n            NULL,\n            \'活期\',\n            -wr.withdraw_amount AS CASH_AMT,\n			5 as type_cd\n    FROM\n        nonobank_app.withdraw_reward wr\n    WHERE\n        wr.status IN (2 , 3, 8)\n            AND wr.trans_code IN (2 , 13, 15)\n			and create_date >= \'${V_BEGIN_DATE}\'\n			and create_date < \'${V_END_DATE}\' \n            AND wr.user_code != 999999999 \n	UNION ALL \n	SELECT \n        create_date,\n            urr.user_code,\n            product_code,\n            NULL,\n            \'活期\',\n            -urr.amount,\n			6 as type_cd\n    FROM\n        nonobank_app.userproduct_ratecard_relation urr\n    INNER JOIN nonobank_app.user_product up ON up.user_product_id = urr.user_product_id\n    WHERE\n        up.product_code IN (\'NN0005\' , \'NN00011\', \'NN0017\')\n		and create_date >= \'${V_BEGIN_DATE}\'\n		and create_date < \'${V_END_DATE}\' \n		) inv',NULL,'2016-12-08 17:09:28','2017-01-03 13:48:39','bofei','bofei','caishen','财神_定期活期交易记录'),
	(93,'SELECT \n    user_code, MIN(dt) AS mdt\nFROM\n    (SELECT \n        DATE_FORMAT(CONCAT(td.trans_date,td.trans_time),\"%Y-%m-%d %H:%i:%s\")  AS dt, user_code, td.amount AS inv_amt\n    FROM\n        nonobank_app.trans_detail td\n    INNER JOIN nonobank_app.product_info pii ON pii.product_code = td.product_code\n    WHERE\n        td.status = 2\n            AND td.trans_code IN (1 , 8)\n            AND pii.product_name IN (\'财神招牌宝\' , \'财神优选宝\', \'新优选宝\')\n            AND td.user_code != 999999999 UNION ALL SELECT \n        (op.created_date) AS dt,\n            user_code,\n            op.invest_amount AS inv_amt\n    FROM\n        nonobank_app.user_product op\n    INNER JOIN nonobank_app.product_info pii ON pii.product_code = op.product_code\n    WHERE\n        pii.product_name NOT IN (\'财神招牌宝\' , \'财神优选宝\', \'新优选宝\')\n            AND op.trans_code = 1\n            AND op.status = 1\n            AND op.user_code != 999999999) t\nGROUP BY user_code',NULL,'2016-12-08 17:57:25','2017-01-04 16:32:53','bofei','bofei','caishen','财神_用户首投时间'),
	(94,'select user_id,register_time,channel,\nchannel_detail,\nprovince,gender,age_range,week_no_of_year,\nweek_begin_date,week_end_date,loss_flag\nfrom \nrpt.v_nono_user \nwhere \nloss_flag=1',NULL,'2016-12-16 11:47:52','2016-12-16 11:47:52','bofei','bofei','impala','诺诺_用户流失'),
	(95,'select  \na.user_id,\na.register_time,\nb.invest_amt,\nb.invest_amt_range,\nb.is_last_invest,\nb.product_type,\nb.invest_time\nfrom \nrpt.v_nono_user a \ninner join \nrpt.v_nono_invest b\non a.user_id=b.user_id\nwhere a.loss_flag=1',NULL,'2016-12-16 15:26:09','2016-12-16 19:31:27','bofei','bofei','impala','诺诺_流失用户投资计录'),
	(96,'SELECT \n        l.create_time as dt\nFROM (select * from db_nono.finance_log where  create_time>=\'${V_BEGIN_DATE}\' \n		AND create_time<\'${V_END_DATE}\' ) l\njoin db_nono.user_info t2 \nON l.user_id=t2.id\njoin db_nono.finance_operation_relation pr\non pr.id = l.operation_relation\nand pr.operation_keyword not in\n(\'benjin_profit\',\'try_cash\',\'company_risk_to_user_benjin\'\n,\'company_risk_to_user_lixi\',\'user_zhuanzhang\',\'toubiao_jiesuo\'\n,\'toubiao_suoding\',\'prolocutor_activity\',\'shouhuankuan_benjin\'\n,\'shouhuankuan_lixi\',\'profit_transfer\',\'site_koukuan\'\n,\'shouhuankuan\',\'site_activity\',\'zhanghuguanli_fee_service\'\n,\'chongzhi_fee_weixin\',\'chongzhi_fee_bill\',\'chongzhi\'\n,\'repay_ahead_weiyuejin\',\'tixian_fee\')\nWHERE \nt2.ID NOT IN(920272,1598,1600,1176674)\nAND t2.is_special<>1\nand l.role_id in (7,13)',NULL,'2016-12-20 10:58:30','2017-06-30 13:30:50','admin','bofei','nono','诺诺_交易记录（参考）'),
	(97,'select user_id,stat_date,channel,\nprovince,gender,age_range,aum,aum_range,\nexpect_range,product_type\nfrom rpt.v_nono_aum\n',NULL,'2016-12-20 18:33:17','2016-12-27 13:04:33','admin','bofei','hive','诺诺_用户AUM'),
	(98,'SELECT \ndu.user_id, \ndu.register_time, du.gender,\ndu.channel, \ndu.province,  \ndu.age_range, \ndu.age_range_sort, \ndu.nono_first_invest_time as first_invest_time ,\ndu.stat_date,\ndu.nono_last_invest_time as last_invest_time,\nCOALESCE(du.nono_aum,0) as AUM,\nCOALESCE(du.nono_balance_amt,0) as BALANCE_AMT\nFROM \nrpt.v_nono_user_stat du',NULL,'2016-12-21 18:53:28','2017-01-22 14:10:58','admin','bofei','hive','诺诺_用户快照'),
	(99,'select run_time\n	from ods.log_app_text',NULL,'2016-12-22 18:26:49','2016-12-27 13:04:33','admin','bofei','hive','诺诺_PV'),
	(100,'SELECT DATE_FORMAT(CONCAT(a.trans_date,a.trans_time),\"%Y-%m-%d %H:%i:%s\") create_date,a.user_code,a.amount,1 kind \n,CASE WHEN   a.trans_detail_id=b.trans_detail_id THEN 1 ELSE 0 END kind2\n,IF(a.trans_code=1,CASE WHEN a.trans_date<DATE_FORMAT(\"2015-09-29\",\"%Y%m%d\") THEN a.amount*0.003 \n	WHEN a.trans_date<DATE_FORMAT(\"2016-01-01\",\"%Y%m%d\") THEN a.amount*0.002 \n	ELSE a.amount*0.0012 END,0) sxf	\nFROM nonobank_app.trans_detail a\nLEFT JOIN risk.xcw_app_user_first b ON a.user_code=b.user_code \nWHERE a.status=2\nAND a.trans_code IN(1,8)\nAND a.trans_date>=DATE_FORMAT(\"${V_BEGIN_DATE}\",\"%Y%m%d\")\nAND a.trans_date<DATE_FORMAT(\"${V_END_DATE}\",\"%Y%m%d\")\nAND a.product_code  IN(\"NN0005\",\"NN00011\",\"NN0017\")\nAND a.user_code !=999999999\n	UNION ALL\nSELECT a.create_date,a.user_code,a.withdraw_amount tx,2 kind,0,CASE WHEN a.create_date<\"2015-09-29\" THEN 1.2 ELSE 1.0 END sxf\nFROM risk.withdraw_reward a\nWHERE 1=1\nAND a.status IN(2,3,8)\nAND a.trans_code IN(2,13,15)\nAND a.create_date>=\"${V_BEGIN_DATE}\"\nAND a.create_date<\"${V_END_DATE}\"\nAND a.user_code !=999999999\n	UNION ALL\nSELECT urr.create_date dd,up.user_code,urr.amount,2 kind,0,0\nFROM nonobank_app.userproduct_ratecard_relation urr\nLEFT JOIN nonobank_app.user_product up ON up.user_product_id=urr.user_product_id\nLEFT JOIN nonobank_app.product_info b ON up.product_code=b.product_code\nWHERE 1=1\nAND up.product_code IN(\"NN0005\",\"NN00011\",\"NN0017\")\nAND urr.create_date>=\"${V_BEGIN_DATE}\"\nAND urr.create_date<\"${V_END_DATE}\"\n	UNION ALL\nSELECT  a.created_date dd,a.user_code,a.invest_amount amount, 1 kind\n,CASE WHEN td.trans_detail_id IS NOT NULL THEN 1 ELSE 0 END kind2\n,IF(urr.user_product_id IS NULL AND c.trans_code=1,CASE WHEN a.created_date<\"2015-09-29\" THEN a.invest_amount*0.003 \n	WHEN a.created_date<\"2016-01-01\" THEN a.invest_amount*0.002 \n	ELSE a.invest_amount*0.0012 END,0) sxf	\nFROM nonobank_app.user_product a\nLEFT JOIN nonobank_app.order_info c ON c.order_id=a.order_id\nLEFT JOIN (SELECT ratecard_product_id user_product_id FROM nonobank_app.userproduct_ratecard_relation GROUP BY 1) urr ON urr.user_product_id=a.user_product_id\nLEFT JOIN risk.xcw_app_user_first b ON a.user_code=b.user_code \nLEFT JOIN nonobank_app.trans_detail td ON td.user_code=b.user_code  AND td.trans_detail_id=b.trans_detail_id AND td.order_id=a.order_id\nWHERE 1=1\nAND a.product_code NOT IN(\"NN0005\",\"NN00011\",\"NN0017\")\nAND a.trans_code=1\nAND a.status=1\nAND a.created_date>=\"${V_BEGIN_DATE}\"\nAND a.created_date<\"${V_END_DATE}\"\nAND a.user_code!=999999999\n	UNION ALL\nSELECT  DATE_ADD(a.invest_end_date,INTERVAL 1 DAY) dd,a.user_code,a.invest_amount,2 kind,0,0\nFROM nonobank_app.user_product a\nLEFT JOIN nonobank_app.order_info c ON c.order_id=a.order_id\nLEFT JOIN (SELECT ratecard_product_id user_product_id FROM nonobank_app.userproduct_ratecard_relation GROUP BY 1) urr ON urr.user_product_id=a.user_product_id\nWHERE 1=1\nAND a.product_code NOT IN(\"NN0005\",\"NN00011\",\"NN0017\",\"NN0018\")\nAND a.trans_code=1\nAND a.status=1\nAND a.invest_end_date>=DATE_ADD(\"${V_BEGIN_DATE}\",INTERVAL -1 DAY)\nAND a.invest_end_date<DATE_ADD(\"${V_END_DATE}\",INTERVAL -1 DAY)\nAND a.user_code!=999999999\n	UNION ALL\nSELECT DATE(uatl.create_date) dd,uatl.user_code,amount ,2 kind,0,0\nFROM nonobank_app.user_account_trans_log uatl\nJOIN nonobank_app.product_info b ON b.product_code=uatl.role_key_word\nWHERE 1=1\nAND uatl.create_date>=\"2016-09-23\"\nAND role_key_word=\"NN0018\"\nAND operation_type=40\nAND uatl.create_date>=\"${V_BEGIN_DATE}\"\nAND uatl.create_date<\"${V_END_DATE}\"\n	UNION ALL\nSELECT a.create_date dd,NULL,0 tx,3 kind,0 kind2,CASE WHEN a.create_date<\"2015-09-29\" THEN 1.2 ELSE 1.0 END sxf\nFROM risk.withdraw_reward a\nWHERE 1=1\nAND a.status IN(2,3,8)\nAND a.trans_code =9\nAND a.create_date>=\"${V_BEGIN_DATE}\"\nAND a.create_date<\"${V_END_DATE}\"\nAND a.user_code !=999999999\n',NULL,'2016-12-29 10:42:29','2016-12-29 10:42:29','bofei','bofei','caishen','财神_交易记录'),
	(101,'select l.user_code,l.total_amount,l.amount,l.create_date,l.update_date\nfrom nonobank_app.user_account_trans_log l\nwhere l.user_code <>999999999',NULL,'2016-12-29 16:36:34','2017-03-13 21:15:34','bofei','bofei','caishen','财神_余额记录'),
	(102,'SELECT a.create_date,a.user_code,a.withdraw_amount\n,b.product_name \nFROM nonobank_app.withdraw_reward a\nLEFT JOIN nonobank_app.product_info b ON CASE WHEN a.trans_code=2 THEN \"NN0005\" WHEN a.trans_code=13 THEN \"NN00011\"  ELSE \"NN0017\" END=b.product_code\nWHERE 1=1\nAND a.trans_code IN(2,13,15)\nAND a.status IN(2,3,8)\nAND a.create_date>=\"${V_BEGIN_DATE}\"\nAND a.create_date<\"${V_END_DATE}\"\nAND a.user_code !=999999999',NULL,'2016-12-29 19:21:18','2016-12-29 19:35:48','bofei','bofei','caishen','活期提现到银行卡记录'),
	(103,'SELECT  a.created_date,a.user_code,a.invest_amount,bb.product_name \nFROM nonobank_app.user_product a\nLEFT JOIN nonobank_app.order_info c ON c.order_id=a.order_id\ninner JOIN (SELECT ratecard_product_id user_product_id FROM nonobank_app.userproduct_ratecard_relation GROUP BY 1) urr ON urr.user_product_id=a.user_product_id\nLEFT JOIN nonobank_app.product_info bb ON a.product_code=bb.product_code\nWHERE 1=1\nAND a.product_code NOT IN(\"NN0005\",\"NN00011\",\"NN0017\")\nAND a.trans_code=1\nAND a.status=1\nAND a.created_date>=\"${V_BEGIN_DATE}\"\nAND a.created_date<\"${V_END_DATE}\"\nAND a.user_code!=999999999',NULL,'2016-12-29 19:26:53','2016-12-29 19:26:53','bofei','bofei','caishen','活转定记录'),
	(104,'select user_code,dt,rank,inv_amt from (\nSELECT \n    user_code, \n	if(@user_cd=t.user_code,@rank:=@rank+1,@rank:=1) as rank,  \n@user_cd:=t.user_code ,dt,inv_amt\nFROM\n    (SELECT \n         DATE_FORMAT(CONCAT(td.trans_date,td.trans_time),\"%Y-%m-%d %H:%i:%s\")  AS dt, user_code, td.amount AS inv_amt\n    FROM\n        nonobank_app.trans_detail td\n    INNER JOIN nonobank_app.product_info pii ON pii.product_code = td.product_code\n    WHERE\n        td.status = 2\n            AND td.trans_code IN (1 , 8)\n            AND pii.product_name IN (\'财神招牌宝\' , \'财神优选宝\', \'新优选宝\')\n            AND td.user_code != 999999999\n            UNION ALL SELECT \n        (op.created_date) AS dt,\n            user_code,\n            op.invest_amount AS inv_amt\n    FROM\n        nonobank_app.user_product op\n    INNER JOIN nonobank_app.product_info pii ON pii.product_code = op.product_code\n    WHERE\n        pii.product_name NOT IN (\'财神招牌宝\' , \'财神优选宝\', \'新优选宝\')\n            AND op.trans_code = 1\n            AND op.status = 1\n            AND op.user_code != 999999999\n	order by user_code,dt) t,(select @user_cd := null ,@rank:=0) a) b \n    where rank<=2\n',NULL,'2016-12-30 14:12:42','2017-01-03 13:54:08','bofei','bofei','caishen','首投_复投_记录'),
	(105,'select card_update_date as dt,privilege_code_id,wp.user_code,\n\'抵扣劵\' as welfare_type,\nup.product_code,up.invest_amount\nfrom \nnonobank_app.welfare_privilege_code wp\ninner join \nnonobank_app.user_product up \non wp.order_id=up.order_id and wp.user_code=up.user_code\nwhere \nwp.use_status=1\nand \nwp.welfare_type=5\nand wp.card_update_date>=\'${V_BEGIN_DATE}\'\nand wp.card_update_date<\'${V_END_DATE}\'',NULL,'2017-01-03 17:25:05','2017-01-04 11:16:24','bofei','bofei','caishen','卡券_使用明细_抵扣劵'),
	(106,'select card_update_date as dt,privilege_code_id,wp.user_code,\n\'特权本金\' as welfare_type,\nup.product_code,up.invest_amount,up.order_id\nfrom \nnonobank_app.welfare_privilege_code wp\ninner join \nnonobank_app.user_product up \non wp.user_code=up.user_code and wp.card_update_date=up.created_date\nwhere \nwp.use_status=1\nand \nwp.welfare_type=3\nand wp.card_update_date>=\'${V_BEGIN_DATE}\'\nand wp.card_update_date<\'${V_END_DATE}\'',NULL,'2017-01-04 11:51:41','2017-01-04 11:51:41','bofei','bofei','caishen','卡券_使用明细_特权本金'),
	(107,'select ${V_BEGIN_DATE} as dt, tw.user_code,up.product_code,up.invest_amount,\'加息券\' as welfare_type\nfrom \n(\nselect \nwp.user_code,ph.product_code,count(1) as cnt\nfrom \nnonobank_app.welfare_privilege_code wp\ninner join \nnonobank_app.product_has_reward ph\non wp.activity_reward_id=ph.reward_id\nwhere \nwp.use_status=1\nand \nwp.welfare_type=2\nand \ndate_add(wp.card_update_date,interval wp.effective_days day)>=\'${V_BEGIN_DATE}\' \nand \nwp.card_update_date <\'${V_END_DATE}\'\ngroup by wp.user_code,ph.product_code\n) tw\ninner join \n(\nSELECT \n    user_code,\n    product_code,\n    remaining_principal AS invest_amount\nFROM\n    nonobank_app.user_product op\nWHERE\n    trans_code = 1 AND status <> \'A\'\n        AND product_code IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n        AND user_code != 999999999\n		AND op.created_date>= \'${V_BEGIN_DATE}\' \n        AND op.created_date < \'${V_END_DATE}\' \nUNION ALL\nSELECT \n    user_code, product_code, invest_amount\nFROM\n    nonobank_app.user_product up\nWHERE\n    up.product_code NOT IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n        AND up.trans_code = 1\n        AND up.status = 1\n        AND up.user_code != 999999999\n        AND DATE_ADD(up.invest_end_date,INTERVAL 1 DAY)>=\'${V_BEGIN_DATE}\' \n        AND up.invest_begin_date < \'${V_END_DATE}\'\n) up \non tw.user_code=up.user_code\nand tw.product_code=up.product_code ',NULL,'2017-01-04 15:05:40','2017-01-04 15:14:48','bofei','bofei','caishen','卡券_使用明细_加息券'),
	(108,'select ${V_BEGIN_DATE} as dt,tw.user_code,\'加息券\' as welfare_type,up.product_code,up.invest_amount\nfrom \n(\nselect \nwp.user_code,ph.product_code,count(1) as cnt\nfrom \nnonobank_app.welfare_privilege_code wp\ninner join \nnonobank_app.product_has_reward ph\non wp.activity_reward_id=ph.reward_id\nwhere \nwp.use_status=1\nand \nwp.welfare_type=2\nand \ndate_add(wp.card_update_date,interval wp.effective_days day)>=\'${V_BEGIN_DATE}\' \nand \nwp.card_update_date <\'${V_END_DATE}\'\ngroup by wp.user_code,ph.product_code\n) tw\ninner join \n(\nSELECT \n    user_code,\n    product_code,\n    remaining_principal AS invest_amount\nFROM\n    nonobank_app.user_product op\nWHERE\n    trans_code = 1 AND status <> \'A\'\n        AND product_code IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n        AND user_code != 999999999\n		AND op.created_date>= \'${V_BEGIN_DATE}\' \n        AND op.created_date < \'${V_END_DATE}\' \nUNION ALL\nSELECT \n    user_code, product_code, invest_amount\nFROM\n    nonobank_app.user_product up\nWHERE\n    up.product_code NOT IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n        AND up.trans_code = 1\n        AND up.status = 1\n        AND up.user_code != 999999999\n        AND DATE_ADD(up.invest_end_date,INTERVAL 1 DAY)>=\'${V_BEGIN_DATE}\' \n        AND up.invest_begin_date < \'${V_END_DATE}\'\n) up \non tw.user_code=up.user_code\nand tw.product_code=up.product_code \nunion all\nselect card_update_date as dt,wp.user_code,\n\'抵扣劵\' as welfare_type,\nup.product_code,up.invest_amount\nfrom \nnonobank_app.welfare_privilege_code wp\ninner join \nnonobank_app.user_product up \non wp.order_id=up.order_id and wp.user_code=up.user_code\nwhere \nwp.use_status=1\nand \nwp.welfare_type=5\nand wp.card_update_date>=\'${V_BEGIN_DATE}\'\nand wp.card_update_date<\'${V_END_DATE}\'\nunion all\nselect card_update_date as dt,wp.user_code,\n\'特权本金\' as welfare_type,\nup.product_code,up.invest_amount\nfrom \nnonobank_app.welfare_privilege_code wp\ninner join \nnonobank_app.user_product up \non wp.user_code=up.user_code and wp.card_update_date=up.created_date\nwhere \nwp.use_status=1\nand \nwp.welfare_type=3\nand wp.card_update_date>=\'${V_BEGIN_DATE}\'\nand wp.card_update_date<\'${V_END_DATE}\'',NULL,'2017-01-04 15:32:39','2017-01-04 15:32:39','bofei','bofei','caishen','卡券_使用明细'),
	(111,'SELECT \nuser_code,amount,create_date\nFROM nonobank_app.user_account_trans_log \nwhere operation_type =\'40\' and role_key_word = \'NN0018\'\nand create_date>=\'${V_BEGIN_DATE}\'\nand create_date<\'${V_END_DATE}\'',NULL,'2017-01-04 17:49:35','2017-01-04 17:52:04','bofei','bofei','caishen','开心财神_转出明细'),
	(112,'SELECT \n    SUM(CASE\n        WHEN\n            DATE(DATE_ADD(up.invest_end_date,\n                    INTERVAL 1 DAY)) > CURDATE()\n        THEN\n            up.invest_amount\n        ELSE 0\n    END) AS invest_amt,\n	SUM(CASE\n        WHEN up.created_date >= CURDATE() THEN up.invest_amount\n        ELSE 0\n    END) - SUM(CASE\n        WHEN\n            DATE(DATE_ADD(up.invest_end_date,\n                    INTERVAL 1 DAY)) = CURDATE()\n        THEN\n            up.invest_amount\n        ELSE 0\n    END) AS d_invest_amt,\n	SUM(CASE\n        WHEN up.created_date >= CURDATE() THEN up.invest_amount\n        ELSE 0\n    END) as in_invest_amt,\n	SUM(CASE\n        WHEN\n            DATE(DATE_ADD(up.invest_end_date,\n                    INTERVAL 1 DAY)) = CURDATE()\n        THEN\n            up.invest_amount\n        ELSE 0\n    END) as out_invest_amt\nFROM\n    nonobank_app.user_product up\nWHERE\n    up.product_code NOT IN (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\n        AND up.trans_code = 1\n        AND up.status = 1\n        AND up.user_code != 999999999	\nunion all\nSELECT \n    SUM(INVEST_AMT) as invest_amt,\n    sum(d_invest_amt) as d_invest_amt,\n	sum(case when liq_type=1 then d_invest_amt end) as in_invest_amt,\n	sum(case when liq_type=2 then abs(d_invest_amt) end) as out_invest_amt\nFROM\n    (SELECT \n        0 INVEST_AMT,\n        SUM(up.invest_amount) AS d_invest_amt,\n		1 as liq_type\n    FROM\n        nonobank_app.user_product up\n    WHERE\n        up.product_code = \'NN0018\'\n            AND up.trans_code = 1\n            AND up.status = 1\n            -- AND up.user_code != 999999999 \n			AND up.created_date >= CURDATE()\n	UNION ALL \n	SELECT \n		0 INVEST_AMT,\n		- SUM(uatl.amount) AS d_invest_amt,\n		2 as liq_type\n    FROM\n        nonobank_app.user_account_trans_log uatl\n	INNER JOIN nonobank_app.product_info b\n        ON b.product_code = uatl.role_key_word\n    WHERE\n        uatl.role_key_word = \'NN0018\'\n    AND uatl.operation_type = 40\n	AND uatl.create_date >= CURDATE()\n	UNION ALL\n	SELECT \n		SUM(remaining_principal) AS INVEST_AMT,\n		0 AS d_invest_amt,\n		0 as liq_type\n	FROM nonobank_app.user_product \n        WHERE trans_code=1\n        AND status=1\n		and product_code=\'NN0018\'\n	) NUM',NULL,'2017-01-06 10:38:23','2017-01-06 10:38:23','bofei','bofei','caishen','财神_定期_开心财神_在投_净入金'),
	(113,'SELECT   (op.invest_begin_date) AS dt_begin,\n  date_add(op.invest_end_date,interval 1 day) AS dt_end,\n        op.user_code,\n        pii.product_name,\n        op.invest_amount AS inv_amt\nFROM nonobank_app.user_product op\nJOIN nonobank_app.product_info pii\nON pii.product_code = op.product_code\nWHERE op.product_code not in (\'NN0005\' , \'NN00011\', \'NN0017\', \'NN0018\')\nAND op.trans_code = 1\nAND op.status = 1\nAND \'${V_END_DATE}\'>op.invest_begin_date\nAND \'${V_BEGIN_DATE}\'<=date_add(op.invest_end_date,interval 1 day)\nAND op.user_code != 999999999\nunion all\nselect \n(op.invest_begin_date) AS dt_begin,\n  date_add(op.invest_end_date,interval 1 day) AS dt_end,\n        op.user_code,\n        pii.product_name,\n        op.remaining_interest AS inv_amt\nFROM nonobank_app.user_product op\nJOIN nonobank_app.product_info pii\nON pii.product_code = op.product_code\nWHERE op.product_code in (\'NN0018\')\nand op.remaining_interest>0\nAND op.trans_code = 1\nAND op.status = 1',NULL,'2017-01-06 11:04:52','2017-01-06 11:04:52','bofei','bofei','caishen','定期_开心财神_在投明细'),
	(116,'SELECT  REGISTER_TIME as dt,\n        id as user_id\n FROM db_nono.user_info\n WHERE USER_NAME NOT LIKE \"%NNBANKAT%\" ','平台_注册记录','2017-01-09 16:20:02','2017-06-30 13:30:50',NULL,'bofei','nono','平台_注册记录'),
	(117,'\nselect sum(INVEST_AMT) as INVEST_AMT,\nsum(d_invest_amt) as d_invest_amt\nfrom (\n-- 散投与债转\nSELECT \n    SUM(INVEST_AMT) AS INVEST_AMT,\n    SUM(d_invest_amt) AS d_invest_amt\nFROM\n    (SELECT \n        0 AS INVEST_AMT,\n            SUM(CASE\n                WHEN bd.pay_time >= CURDATE() THEN bd.price_in\n                ELSE 0\n            END) AS d_invest_amt\n    FROM\n        db_nono.borrows_bidding bd\n    WHERE\n        bd.is_vip = 0 AND bd.status IN (1 , 2) \n		and user_id IN (920272,12027)\n		UNION ALL SELECT \n        SUM(CASE\n                WHEN is_pay = 0 THEN ba.price_principal\n                ELSE 0\n            END) ACCEPT_AMT,\n            - SUM(CASE\n                WHEN\n                    ba.success_time >= CURDATE()\n                        AND is_pay = 1\n                THEN\n                    ba.price_principal\n                ELSE 0\n            END) AS d_accept_amt\n    FROM\n        db_nono.borrows_accept ba\n    WHERE\n        ba.is_vip = 0\n        and user_id IN (920272,12027)\n	UNION ALL SELECT \n        0 AS INVEST_AMT,\n        SUM(price_in) AS d_invest_amt\n    FROM\n        db_nono.debt_buy_log dbl\n    WHERE\n        dbl.p_type = 3 AND dbl.status = 1\n		and pay_time >= CURDATE()\n            AND (dbl.va_id IS NULL OR dbl.va_id = 0)\n			and user_id IN (920272,12027)\n            ) num\nunion all\n-- 诺诺定期 日净入金\nselect COALESCE(balance_amt,0) as balance_amt,COALESCE(invest_amt,0) as d_invest_amt\nfrom (\nSELECT \n    SUM(invest_amt) as invest_amt\nFROM\n    (SELECT \n        SUM(amount_payed) INVEST_AMT\n    FROM\n        db_nono.vip_form vf\n    INNER JOIN db_nono.finance_plan fp ON vf.fp_id = fp.id\n    WHERE\n        service_status = 1 AND fp.scope != 15\n            AND vf.service_time >= CURDATE() \n			and vf.user_id in (920272,12027)\n	UNION ALL \n    SELECT \n        - SUM(IFNULL(vf.amount_payed, va.amount)) INVEST_AMT\n    FROM\n        db_nono.vip_account va\n    LEFT JOIN db_nono.vip_form vf ON vf.user_id = va.user_id\n        AND vf.fp_id = va.fp_id\n        AND vf.service_status = 1\n    INNER JOIN db_nono.finance_plan fp ON va.fp_id = fp.id AND scope != 15\n    INNER JOIN db_nono.finance_log fl2 ON fl2.key_value = va.id\n        AND fl2.operation_relation = 597\n        AND fl2.create_time >= CURDATE()\n		and va.user_id in (920272,12027)\n        ) num) ta,\n(\n-- 诺诺定期 余额\nSELECT \n    sum(COALESCE(vf.amount_payed,va.amount)) AS balance_amt\nFROM\n    db_nono.vip_account va\nleft JOIN\n    db_nono.vip_form vf ON vf.user_id = va.user_id\nAND vf.fp_id = va.fp_id\nAND vf.service_status = 1\nWHERE\n    va.is_cash = 0\n    and (\n    va.fp_id is null\n    or\n	va.fp_id in (select id from db_nono.finance_plan where scope != 15)\n    )\n	and va.user_id in (920272,12027)) tb\n	) tta',NULL,'2017-01-18 14:11:48','2017-06-30 13:30:50','admin','bofei','nono','资金流动性_特殊帐户_余额_日净入金'),
	(118,'select COALESCE(invest_amt,0) as invest_amt,COALESCE(d_invest_amt,0) as d_invest_amt\nfrom \n(select balance as invest_amt \nfrom db_nono.finance_account\nwhere user_id in (920272)\nand role_id=7) a,\n(select sum(income)-sum(expend) as d_invest_amt \nfrom db_nono.finance_log \nwhere account_id=(select id from db_nono.finance_account\nwhere user_id in (920272)\nand role_id=7)\nand create_time>=curdate()) b',NULL,'2017-01-18 14:15:31','2017-06-30 13:30:50','admin','bofei','nono','资金流动性_特殊帐户_余额_净入金'),
	(119,'select user_id,stat_date,channel,\nprovince,gender,age_range,aum,aum_range,\nexpect_range,product_type\nfrom rpt.v_cs_aum',NULL,'2017-01-20 10:42:54','2017-01-20 10:42:54','bofei','bofei','hive','财神_用户AUM'),
	(120,'\nselect \n    channel, \n    province,\n    age_range,\n    gender,\n    register_date dt,\n    first_invest_amount,\n    aum,\n    user_id\nfrom rpt.v_cs_user','财神注册','2017-01-20 11:23:34','2017-01-23 15:32:29',NULL,'zhangbingcan','impala','财神注册'),
	(121,'	select user_id,stat_date,aum,aum_range\nfrom rpt.v_cs_user_stat',NULL,'2017-01-20 17:57:43','2017-01-20 17:57:43','bofei','bofei',NULL,'财神_AUM_USER'),
	(122,'SELECT STAT_DATE ,USER_ID,CSYY_AUM,CSYY_AUM_RANGE AS AUM_RANGE FROM RPT.V_CS_USER_STAT WHERE CSYY_AUM>0',NULL,'2017-01-20 18:08:23','2017-01-22 10:15:30','bofei','bofei','hive','财神_AUM_USER'),
	(123,'SELECT \ndu.user_id, \ndu.register_time, du.gender,\ndu.channel_category as channel, \ndu.province,  \ndu.age_range, \ndu.age_range_sort, \ndu.csyy_first_invest_time as first_invest_time ,\ndu.stat_date,\ndu.csyy_last_invest_time as last_invest_time,\nCOALESCE(du.csyy_aum,0) as AUM,\nCOALESCE(du.csyy_balance_amt,0) as BALANCE_AMT\nFROM \nrpt.v_cs_user_stat du',NULL,'2017-01-22 11:45:07','2017-01-22 14:10:58','bofei','bofei','hive','财神_用户快照'),
	(126,'select COALESCE(invest_amt,0) as invest_amt,COALESCE(d_invest_amt,0) as d_invest_amt\nfrom \n(select balance as invest_amt \nfrom db_nono.finance_account\nwhere user_id in (920272)\nand role_id=13) a,\n(select sum(income)-sum(expend) as d_invest_amt \nfrom db_nono.finance_log \nwhere account_id in (select id from db_nono.finance_account\nwhere user_id in (920272)\nand role_id=13)\nand create_time>=curdate()) b',NULL,'2017-02-15 16:05:23','2017-06-30 13:30:50','bofei','bofei','nono','资金流动性_特殊帐户VIP_余额_净入金'),
	(131,'select COALESCE(invest_amt,0) as invest_amt,COALESCE(d_invest_amt,0) as d_invest_amt\nfrom \n(select SUM(balance-locking) as invest_amt \nfrom db_nono.finance_account\nwhere user_id not in (920272)\nand role_id=13) a,\n(select sum(income)-sum(expend) as d_invest_amt\nfrom \n(\nselect id,account_id,income,expend from db_nono.finance_log \nwhere \ncreate_time>=\'${V_BEGIN_DATE}\' and create_time<=\'${V_END_DATE}\'\n) lg \ninner join \n(SELECT id\nFROM db_nono.finance_account a\nWHERE \nrole_id=13\nand user_id not in (920272)) fa \non lg.account_id = fa.id\n) b','资金流动性_诺诺待匹配_余额','2017-02-15 20:35:14','2017-06-30 13:30:50','bofei','bofei','nono','资金流动性_诺诺待匹配_余额'),
	(132,' select \n	logon_time\n    ,logon_status\n    ,logon_status_desc\n    ,logon_type\n    ,login_biz\nfrom db_nono_legacy.user_login_detail_log\nwhere logon_time>= \'${V_BEGIN_DATE}\' and logon_time < \'${V_END_DATE}\'','平台登录记录','2017-02-22 15:35:20','2017-02-22 17:12:02','zhangbingcan','zhangbingcan','archive','平台登录'),
	(133,'select \n pay_type,\n recharge_status,\n user_id,\n create_time dt\nfrom db_nono.yilian_recharges\nwhere create_time>=\'${V_BEGIN_DATE}\' and create_time<=\'${V_END_DATE}\'','旧_易联交易','2017-02-24 18:02:37','2017-06-30 13:30:50','zhangbingcan','bofei','nono','旧_易联交易'),
	(134,'select \nuser_id,\ntrans_num,\namount,\nreceive_message,\nreceive_status,\nkrl_log_type,\nremarks,\ncreate_time\nfrom db_nono.kuaiq_recharge_logs\nwhere create_time>=\'${V_BEGIN_DATE}\' and create_time<=\'${V_END_DATE}\'\nand krl_log_type = 2','旧_快钱转出','2017-02-24 18:36:12','2017-06-30 13:30:50','zhangbingcan','bofei','nono','旧_快钱转出_诺诺'),
	(135,'select \n	l.result_code,\n    l.result_msg,\n    r.member_id as user_id,\n    r.create_time, r.status,\n    r.pay_amount\nfrom  db_nono_pay.tb_pay_record_log l\njoin db_nono_pay.tb_pay_record r\non l.order_no = r.order_no\nwhere r.create_time>=\'${V_BEGIN_DATE}\' and r.create_time<=\'${V_END_DATE}\' ','旧_平台充值','2017-02-24 19:16:48','2017-06-30 13:30:50','zhangbingcan','bofei','nono','旧_平台充值'),
	(136,'select OrderAmount,\n	TransStatus,\n    create_time\n from db_nono.sft_recharges r\nwhere  r.create_time>=\'${V_BEGIN_DATE}\' and r.create_time<=\'${V_END_DATE}\' ','旧_盛付通交易','2017-02-28 14:41:05','2017-06-30 13:30:50','zhangbingcan','bofei','nono','旧_盛付通交易'),
	(138,'SELECT create_time,\n	   income,\n       expend,\n       income - expend AS unmatched\nFROM   db_nono.finance_log lg\ninner join ( SELECT id\n				 FROM   db_nono.finance_account a\n				 WHERE  role_id = 13 AND\n						user_id NOT IN ( 920272 ) \n                        ) fa\nON lg.account_id = fa.id\nWHERE  lg.create_time >= \'${V_BEGIN_DATE}\' AND\n	   lg.create_time <= \'${V_END_DATE}\'','理财账户余额变动','2017-03-01 10:19:36','2017-06-30 13:30:50','zhangbingcan','bofei','nono','理财账户余额变动'),
	(147,'select sum(balance - locking) as amount\nfrom db_nono.finance_account fa\nJOIN db_nono.user_info ui \nON ui.id=fa.user_id \nand ui.is_special=0\nAND ui.id NOT IN(166,168,169,170,920272\n,1598,1600,13936,1060684,897999,7589082\n,1006586,843923,2015856\n,2042527,8129243,1126825,10699642,1006463\n,71799,3393956,1245897,12444282,1025132\n,1025364,7060345,11995972,3404962,3408327\n,1348069,7847437,7448431,1011262,1404313\n,3392450,1006419,1024347,76551,3514689)\nwhere role_id = 7','账户余额（不含财神）','2017-03-08 17:25:23','2017-06-30 13:30:50','zhangbingcan','bofei','nono','账户余额（不含财神）'),
	(148,'select dt,user_id,inv_amt,rank\nfrom (\nselect dt,user_id,inv_amt\n,if(@user_id=ta.user_id,@rank:=@rank+1,@rank:=1) as rank,  \n@user_id:=ta.user_id  \nfrom \n(\nSELECT \n   t1.CUR_DT          as dt,\n   t1.user_id         as user_id,\n   t1.amount_payed    as inv_amt\nFROM\n(SELECT DATE(service_time) AS CUR_DT,user_id,amount_payed\n   FROM db_nono.vip_form -- 定期\n   WHERE service_status=1\n\nUNION ALL -- 债转\nSELECT DATE(pay_time) AS cur_dt,user_id,price_in\n		FROM db_nono.debt_buy_log\n		WHERE p_type=3\n		AND STATUS=1\n		AND (va_id IS NULL OR va_id =0)\nUNION ALL -- 散投\nselect date(pay_time) as cur_dt,bd.user_id,bd.price_in \nfrom db_nono.borrows_bidding bd \nwhere bd.is_vip = 0 and bd.status in(1,2) and reason = \'诺诺盈\'\n\nUNION ALL -- 活期\nSELECT DATE(ff_service_time) AS cur_dt,user_id,ff_amount_payed\n		FROM db_nono.fund_form ff\n         JOIN db_nono.csyy_plan cp\n      ON ff.csyy_serial_number = cp.serial_number\n		WHERE ff_service_status=1\n) t1\nINNER JOIN db_nono.user_info t2 ON t1.user_id=t2.id\nWHERE t2.ID NOT IN(920272,1598,1600,1176674)\nAND t2.is_special<>1\norder by t1.user_id,t1.CUR_DT) ta,\n(select @rownum :=0 , @user_id := null ,@rank:=0) r\n) tta ',NULL,'2017-04-13 20:22:40','2017-06-30 13:30:50','bofei','bofei','nono','诺诺投资排序'),
	(149,'SELECT\n  DATE(vf.service_time) AS dt,\n  TRIM(IF(uc.approach_desc IS NULL OR uc.approach_desc = \'\',\'未知券码\',uc.approach_desc))   AS coupon_name,\n  fpc.label as product_name,\n  vf.user_id,\n  vf.id,\n  IF(uc.type=0,uc.value,0) AS cash_value,\n  (case \n    when fp.scope =15 then 30\n    when fp.expect_unit = 0 then fp.expect*30\n    when fp.expect_unit =1  then fp.expect\n    else  fp.expect * 360 end ) *  vf.amount_payed * if(uc.type=1 ,uc.value,0)/100 /360 as  rate_value,\n  vf.amount_payed AS inv_amt,\n  uc.id AS coupon_id,uc.type,\n  case when fp.scope=1 then \'新客\'\n	when  fp.scope=15 then \'月月升\'\n	when fp.expect_unit=0 then concat(expect,\'个月\')\n	when fp.expect_unit=1 then concat(expect/30,\'个月\')\n	end as expect_name\nFROM db_nono.coupon_use cu\n  JOIN db_nono.user_coupon uc\n    ON uc.id = cu.uv_id\n      AND cu.ir_product_type = 1\n  JOIN db_nono.vip_form vf\n    ON vf.id = cu.bb_id\n    AND vf.service_status = 1\n  JOIN db_nono.user_info ui\n    ON ui.id = vf.user_id\n  LEFT JOIN db_nono.finance_plan fp\n    ON vf.fp_id = fp.id\n  LEFT JOIN db_nono.finance_plan_scope fpc\n   ON fp.scope = fpc.id\nwhere \nvf.service_time>=\'${V_BEGIN_DATE}\'\nand vf.service_time<\'${V_END_DATE}\'',NULL,'2017-04-14 15:58:08','2017-06-30 13:30:50','bofei','bofei','nono','用券信息'),
	(150,'SELECT bo.user_id,ba.create_time as dt, bo.p_id\nFROM db_nono.borrows_archive ba \nJOIN db_nono.borrows bo \nON ba.bo_id=bo.id \nWHERE ba.is_audit!=0\nand bo.p_id  IN(77,83,87,88,102) and ba.create_time>= \'${V_BEGIN_DATE}\' and ba.create_time < \'${V_END_DATE}\'','名校贷_进件','2017-04-17 16:09:08','2017-06-30 13:30:50','zhangbingcan','bofei','nono','名校贷_进件'),
	(151,' SELECT   prl.create_time as dt\n,ui.id as user_id\nFROM db_nono.pengyuan_recharge_log prl\nJOIN db_nono.user_info ui ON ui.id_num=prl.idnum \nLEFT JOIN db_nono.user_approach_info uai ON ui.id = uai.user_id\nLEFT JOIN db_nono.admin ad ON uai.channel_id = ad.id\nLEFT JOIN db_nono.channel c ON uai.channel_id = c.id\nWHERE (ui.user_type = 5 OR ad.am_name LIKE \'%mxd%\')\n       AND (uai.channel_id IS NULL\n             OR uai.channel_id NOT IN(1867,1882,1915))\n       AND (c.channel_type IS NULL\n             OR (c.channel_type <> 8))\n       AND NOT IFNULL(uai.landing_page,\'x\') LIKE \'%美国名校贷%\'\nAND query_id IN(\'25126\',\'25159\',\'25184\')\nand prl.create_time>=  \'${V_BEGIN_DATE}\' and prl.create_time < \'${V_END_DATE}\'\nAND (prl.response LIKE \"%customerType>2</customerType>%\"\n       OR  prl.response LIKE \"%customerType>3</customerType>%\"\n       OR prl.response LIKE \"%一致%\")\n       AND prl.response NOT LIKE \"%不一致%\"','名校贷_学籍认证_新口径','2017-04-18 17:13:19','2017-06-30 13:30:50','zhangbingcan','bofei','nono','名校贷_学籍认证_新口径'),
	(152,'select \nba.create_time as dt\n,bo.p_id\n,bo.user_id  \nfrom db_nono.borrows bo \njoin db_nono.borrows_archive ba on bo.id=ba.bo_id and keyword=\'borrow_video_audit\'\njoin db_nono.borrows_raise br on bo.id=br.bo_id\nwhere bo.p_id IN (77, 88) and ba.create_time>=\'${V_BEGIN_DATE}\' and ba.create_time<=\'${V_END_DATE}\'',NULL,'2017-06-15 14:56:43','2017-06-30 13:30:50','hudie','bofei','nono','名校贷一键再借1'),
	(157,'select bo.p_id\n	,bo.id\n	,bo.user_id\n	,bo.bo_price\n	,bo.bo_audit_time dt\nfrom db_nono.borrows_raise br \nJOIN db_nono.borrows bo on br.bo_id=bo.id\njoin db_nono.borrows_archive ba on br.bo_id=ba.bo_id  and is_confirm=1 and keyword=\'borrow_video_audit\'\nwhere bo.p_id  IN (77, 88) and bo.bo_audit_time>=\'${V_BEGIN_DATE}\' and bo.bo_audit_time <=\'${V_END_DATE}\'\n',NULL,'2017-06-15 17:28:25','2017-06-30 13:30:50','hudie','bofei','nono','名校贷一键再借2'),
	(158,'\n\nselect bo.bo_audit_time dt\n,is_confirm\n,bo.p_id\n,bo.user_id\nfrom db_nono.borrows_raise br \njoin db_nono.borrows bo  on br.bo_id=bo.id \njoin db_nono.borrows_archive ba on br.bo_id=ba.bo_id \nwhere bo.p_id IN (77, 88) and is_confirm in (1,2) and keyword=\'borrow_video_audit\' \nand bo.bo_audit_time>=\'${V_BEGIN_DATE}\' and bo.bo_audit_time <=\'${V_END_DATE}\'\n',NULL,'2017-06-15 17:40:34','2017-06-30 13:30:50','hudie','bofei','nono','名校贷一键再借3');

/*!40000 ALTER TABLE `ETL_IS_SQL_PATTERN` ENABLE KEYS */;
UNLOCK TABLES;



/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
